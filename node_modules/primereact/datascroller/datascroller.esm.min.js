import*as e from"react";import{PrimeReactContext as r,localeOption as t}from"primereact/api";import{useMountEffect as n,useUpdateEffect as l,useUnmountEffect as o}from"primereact/hooks";import{classNames as a,mergeProps as u,ObjectUtils as c}from"primereact/utils";import{ComponentBase as i}from"primereact/componentbase";function s(e,r){(null==r||r>e.length)&&(r=e.length);for(var t=0,n=new Array(r);t<r;t++)n[t]=e[t];return n}function f(e){if(Array.isArray(e))return s(e)}function m(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}function d(e,r){if(e){if("string"==typeof e)return s(e,r);var t=Object.prototype.toString.call(e).slice(8,-1);return"Object"===t&&e.constructor&&(t=e.constructor.name),"Map"===t||"Set"===t?Array.from(e):"Arguments"===t||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(t)?s(e,r):void 0}}function p(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function y(e){return f(e)||m(e)||d(e)||p()}function v(e){if(Array.isArray(e))return e}function h(e,r){var t=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=t){var n,l,o,a,u=[],c=!0,i=!1;try{if(o=(t=t.call(e)).next,0===r){if(Object(t)!==t)return;c=!1}else for(;!(c=(n=o.call(t)).done)&&(u.push(n.value),u.length!==r);c=!0);}catch(e){i=!0,l=e}finally{try{if(!c&&null!=t.return&&(a=t.return(),Object(a)!==a))return}finally{if(i)throw l}}return u}}function g(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var b=i.extend({defaultProps:{__TYPE:"DataScroller",id:null,value:null,rows:0,inline:!1,scrollHeight:null,loader:!1,buffer:.9,style:null,className:null,onLazyLoad:null,emptyMessage:null,itemTemplate:null,header:null,footer:null,lazy:!1,children:void 0}}),w=e.memo(e.forwardRef((function(i,s){var f,m,p=e.useContext(r),w=b.getProps(i,p),E=e.useState([]),S=(m=2,v(f=E)||h(f,m)||d(f,m)||g()),H=S[0],L=S[1],A=b.setMetaData({props:w}).ptm,N=e.useRef(null),T=e.useRef(null),z=e.useRef(w.value),M=e.useRef([]),R=e.useRef(0),j=e.useRef(null),x=function(){if(w.lazy)w.onLazyLoad&&w.onLazyLoad(O()),R.current+=w.rows;else if(z.current){for(var e=R.current;e<R.current+w.rows&&!(e>=z.current.length);e++)M.current.push(z.current[e]);0!==z.current.length&&(R.current+=w.rows),L(y(M.current))}},I=function(){R.current=0,M.current=[],L(y(M.current)),x()},O=function(){return{first:R.current,rows:w.rows}},P=function(){j.current&&(w.inline&&T.current?T.current.removeEventListener("scroll",j.current):w.loader||window.removeEventListener("scroll",j.current)),j.current=null};n((function(){x(),w.loader||(w.inline?(j.current=function(){T.current.scrollTop>=T.current.scrollHeight*w.buffer-T.current.clientHeight&&x()},T.current.addEventListener("scroll",j.current)):(j.current=function(){var e=document.body,r=document.documentElement,t=window.pageYOffset||document.documentElement.scrollTop,n=r.clientHeight;t>=Math.max(e.scrollHeight,e.offsetHeight,n,r.scrollHeight,r.offsetHeight)*w.buffer-n&&x()},window.addEventListener("scroll",j.current)))})),l((function(){w.value&&(z.current=w.value,w.lazy||(R.current=0),M.current=[],w.lazy?(M.current=z.current,L(y(M.current))):x())}),[w.value]),l((function(){w.loader&&P()}),[w.loader]),o((function(){j.current&&P()})),e.useImperativeHandle(s,(function(){return{props:w,load:x,reset:I,getElement:function(){return N.current},getContent:function(){return T.current}}}));var C,D,_=function(r,t){var n=u({key:t+"_datascrollitem"},A("item")),l=w.itemTemplate?w.itemTemplate(r):r;return e.createElement("li",n,l)},k=function(){var r=u(A("emptyMessage")),n=c.getJSXElement(w.emptyMessage,w)||t("emptyMessage");return e.createElement("li",r,n)},Y=a("p-datascroller p-component",w.className,{"p-datascroller-inline":w.inline}),J=(C=u({className:"p-datascroller-header"},A("header")),w.header?e.createElement("div",C,w.header):null),U=(D=u({className:"p-datascroller-footer"},A("footer")),w.footer?e.createElement("div",D,w.footer):null),X=function(){var r=u({ref:T,className:"p-datascroller-content",style:{maxHeight:w.scrollHeight}},A("content")),t=u({className:"p-datascroller-list"},A("list")),n=c.isNotEmpty(H)?H.map(_):k();return e.createElement("div",r,e.createElement("ul",t,n))}(),$=u({id:w.id,ref:N,className:Y},b.getOtherProps(w),A("root"));return e.createElement("div",$,J,X,U)})));w.displayName="DataScroller";export{w as DataScroller};
