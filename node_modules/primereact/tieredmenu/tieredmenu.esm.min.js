import*as e from"react";import n,{PrimeReactContext as t}from"primereact/api";import{CSSTransition as r}from"primereact/csstransition";import{useEventListener as o,useResizeListener as i,useMountEffect as u,useUpdateEffect as l,useMatchMedia as a,useOverlayListener as c,useUnmountEffect as p}from"primereact/hooks";import{OverlayService as s}from"primereact/overlayservice";import{Portal as m}from"primereact/portal";import{classNames as f,mergeProps as d,DomHandler as b,IconUtils as v,ObjectUtils as y,UniqueComponentId as g,ZIndexUtils as h}from"primereact/utils";import{ComponentBase as w}from"primereact/componentbase";import{Ripple as S}from"primereact/ripple";import{AngleRightIcon as E}from"primereact/icons/angleright";function I(e){if(Array.isArray(e))return e}function O(e,n){var t=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=t){var r,o,i,u,l=[],a=!0,c=!1;try{if(i=(t=t.call(e)).next,0===n){if(Object(t)!==t)return;a=!1}else for(;!(a=(r=i.call(t)).done)&&(l.push(r.value),l.length!==n);a=!0);}catch(e){c=!0,o=e}finally{try{if(!a&&null!=t.return&&(u=t.return(),Object(u)!==u))return}finally{if(c)throw o}}return l}}function x(e,n){(null==n||n>e.length)&&(n=e.length);for(var t=0,r=new Array(n);t<n;t++)r[t]=e[t];return r}function M(e,n){if(e){if("string"==typeof e)return x(e,n);var t=Object.prototype.toString.call(e).slice(8,-1);return"Object"===t&&e.constructor&&(t=e.constructor.name),"Map"===t||"Set"===t?Array.from(e):"Arguments"===t||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(t)?x(e,n):void 0}}function P(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function k(e,n){return I(e)||O(e,n)||M(e,n)||P()}var T=w.extend({defaultProps:{__TYPE:"TieredMenu",id:null,model:null,popup:!1,style:null,className:null,autoZIndex:!0,baseZIndex:0,breakpoint:void 0,scrollHeight:"400px",appendTo:null,transitionOptions:null,onShow:null,onHide:null,submenuIcon:null,children:void 0}});function j(e){return j="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},j(e)}function N(e,n){if("object"!==j(e)||null===e)return e;var t=e[Symbol.toPrimitive];if(void 0!==t){var r=t.call(e,n||"default");if("object"!==j(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===n?String:Number)(e)}function C(e){var n=N(e,"string");return"symbol"===j(n)?n:String(n)}function D(e,n,t){return(n=C(n))in e?Object.defineProperty(e,n,{value:t,enumerable:!0,configurable:!0,writable:!0}):e[n]=t,e}function H(e,n){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);n&&(r=r.filter((function(n){return Object.getOwnPropertyDescriptor(e,n).enumerable}))),t.push.apply(t,r)}return t}function A(e){for(var n=1;n<arguments.length;n++){var t=null!=arguments[n]?arguments[n]:{};n%2?H(Object(t),!0).forEach((function(n){D(e,n,t[n])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):H(Object(t)).forEach((function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))}))}return e}var R=e.memo((function(n){var t=k(e.useState(null),2),r=t[0],a=t[1],c=e.useRef(null),p=function(e,t){return n.ptm(t,{context:{active:r===e}})},s=k(o({type:"click",listener:function(e){n.isMobileMode||!c.current||c.current.contains(e.target)||a(null)}}),1)[0],m=k(i({listener:function(){!n.isMobileMode&&a(null)}}),1)[0],g=function(){if(c.current){var e=c.current.parentElement,n=b.getOffset(e),t=b.getViewport(),r=c.current.offsetParent?c.current.offsetWidth:b.getHiddenElementOuterWidth(c.current),o=b.getOuterWidth(e.children[0]),i=parseInt(n.top,10)+c.current.offsetHeight-b.getWindowScrollTop();c.current.style.top=i>t.height?t.height-i+"px":"0px",parseInt(n.left,10)+o+r>t.width-b.calculateScrollbarWidth()&&b.addClass(c.current,"p-submenu-list-flipped")}},h=function(e,t){t.disabled||n.isMobileMode?e.preventDefault():n.root?(r||n.popup)&&a(t):a(t)},w=function(e,t){t.disabled?e.preventDefault():(t.url||e.preventDefault(),t.command&&t.command({originalEvent:e,item:t}),(n.root||n.isMobileMode)&&t.items&&a(r&&t===r?null:t),t.items||P(e))},I=function(e,t){var r=e.currentTarget.parentElement;switch(e.which){case 40:var o=x(r);o&&o.children[0].focus(),e.preventDefault();break;case 38:var i=M(r);i&&i.children[0].focus(),e.preventDefault();break;case 39:t.items&&(a(t),setTimeout((function(){r.children[1].children[0].children[0].focus()}),50)),e.preventDefault()}n.onKeyDown&&n.onKeyDown(e,r)},O=function(e,n){37===e.which&&(a(null),n.parentElement.previousElementSibling.focus())},x=function e(n){var t=n.nextElementSibling;return t?b.hasClass(t,"p-disabled")||!b.hasClass(t,"p-menuitem")?e(t):t:null},M=function e(n){var t=n.previousElementSibling;return t?b.hasClass(t,"p-disabled")||!b.hasClass(t,"p-menuitem")?e(t):t:null},P=function(e){n.isMobileMode&&!n.popup||(a(null),n.onLeafClick&&n.onLeafClick(e),n.onHide&&n.onHide(e))};u((function(){s(),m()})),l((function(){n.parentActive||a(null),n.root||!n.parentActive||n.isMobileMode||g()}),[n.parentActive]),l((function(){n.onItemToggle&&n.onItemToggle()}),[r]);var T=function(t){var r=d({key:"separator_"+t,className:"p-menu-separator",role:"separator"},n.ptm("separator"));return e.createElement("li",r)},j=function(t){return t.items?e.createElement(R,{menuProps:n.menuProps,model:t.items,onLeafClick:P,popup:n.popup,onKeyDown:O,parentActive:t===r,isMobileMode:n.isMobileMode,onItemToggle:n.onItemToggle,submenuIcon:n.submenuIcon,ptm:n.ptm}):null},N=function(t,o){if(!1===t.visible)return null;var i=t.style,u=t.disabled,l=t.icon,a=t.label,c=t.items,s=t.target,m=t.url,b=t.template,g=a+"_"+o,O=r===t,x=f("p-menuitem",{"p-menuitem-active":O},t.className),M=f("p-menuitem-link",{"p-disabled":u}),P=f("p-menuitem-icon",l),k=d({className:P},p(t,"icon")),T=v.getJSXIcon(l,A({},k),{props:n.menuProps}),N=d({className:"p-menuitem-text"},p(t,"label")),C=a&&e.createElement("span",N,a),D="p-submenu-icon",H=d({className:D},p(t,"submenuIcon")),R=t.items&&v.getJSXIcon(n.submenuIcon||e.createElement(E,H),A({},H),{props:n.menuProps}),Z=j(t),K=d({href:m||"#",className:M,target:s,role:"menuitem","aria-haspopup":null!=c,onClick:function(e){return w(e,t)},onKeyDown:function(e){return I(e,t)},"aria-disabled":u},p(t,"action")),W=e.createElement("a",K,T,C,R,e.createElement(S,null));b&&(W=y.getJSXElement(b,t,{onClick:function(e){return w(e,t)},onKeyDown:function(e){return I(e,t)},className:M,labelClassName:"p-menuitem-text",iconClassName:P,submenuIconClassName:D,element:W,props:n,active:O,disabled:u}));var L=d({key:g,id:t.id,className:x,style:i,onMouseEnter:function(e){return h(e,t)},role:"none"},p(t,"menuitem"));return e.createElement("li",L,W,Z)},C=function(e,n){return e.separator?T(n):N(e,n)},D=f({"p-submenu-list":!n.root}),H=n.model?n.model.map(C):null,Z=d({ref:c,className:D,role:n.root?"menubar":"menu","aria-orientation":"horizontal"},n.ptm("menu"));return e.createElement("ul",Z,H)}));R.displayName="TieredMenuSub";var Z=e.memo(e.forwardRef((function(o,i){var v=e.useContext(t),y=T.getProps(o,v),w=k(e.useState(!y.popup),2),S=w[0],E=w[1],I=k(e.useState(null),2),O=I[0],x=I[1],M=T.setMetaData({props:y,state:{visible:S,attributeSelector:O}}).ptm,P=e.useRef(null),j=e.useRef(null),N=e.useRef(null),C=a("screen and (max-width: ".concat(y.breakpoint,")"),!!y.breakpoint),D=k(c({target:j,overlay:P,listener:function(e,n){n.valid&&L(e)},when:S}),2),H=D[0],A=D[1],Z=function(e){y.popup&&s.emit("overlay-click",{originalEvent:e,target:j.current})},K=function(e){y.popup&&(S?L(e):W(e))},W=function(e){j.current=e.currentTarget,E(!0),y.onShow&&y.onShow(e)},L=function(e){y.popup&&(j.current=e.currentTarget,E(!1),y.onHide&&y.onHide(e))},_=function(){y.popup&&C&&b.absolutePosition(P.current,j.current)},z=function(){if(!N.current){N.current=b.createInlineStyle(v&&v.nonce||n.nonce);var e="".concat(O),t="\n@media screen and (max-width: ".concat(y.breakpoint,") {\n    .p-tieredmenu[").concat(e,"] > ul {\n        max-height: ").concat(y.scrollHeight,";\n        overflow: ").concat(y.scrollHeight?"auto":"",";\n    }\n\n    .p-tieredmenu[").concat(e,"] .p-submenu-list {\n        position: relative;\n    }\n\n    .p-tieredmenu[").concat(e,"] .p-menuitem-active > .p-submenu-list {\n        left: 0 !important;\n        box-shadow: none;\n        border-radius: 0;\n        padding: 0 0 0 calc(var(--inline-spacing) * 2); /* @todo */\n    }\n\n    .p-tieredmenu[").concat(e,"] .p-menuitem-active > .p-menuitem-link > .p-submenu-icon {\n        transform: rotate(-180deg);\n    }\n\n    .p-tieredmenu[").concat(e,'] .p-submenu-icon:before {\n        content: "\\e930";\n    }\n\n    ').concat(y.popup?"":".p-tieredmenu[".concat(e,"] { width: 100%; }"),"\n}\n");N.current.innerHTML=t}},J=function(){N.current=b.removeInlineStyle(N.current)},X=function(){y.autoZIndex&&h.set("menu",P.current,v&&v.autoZIndex||n.autoZIndex,y.baseZIndex||v&&v.zIndex.menu||n.zIndex.menu),b.absolutePosition(P.current,j.current),O&&y.breakpoint&&(P.current.setAttribute(O,""),z())},U=function(){H()},V=function(){j.current=null,A()},Y=function(){h.clear(P.current),J()};u((function(){y.breakpoint&&!O&&x(g())})),l((function(){return O&&P.current&&(P.current.setAttribute(O,""),z()),function(){J()}}),[O,y.breakpoint]),p((function(){h.clear(P.current)})),e.useImperativeHandle(i,(function(){return{props:y,toggle:K,show:W,hide:L,getElement:function(){return P.current}}}));var $=function(){T.getOtherProps(y);var t=f("p-tieredmenu p-component",{"p-tieredmenu-overlay":y.popup,"p-input-filled":v&&"filled"===v.inputStyle||"filled"===n.inputStyle,"p-ripple-disabled":v&&!1===v.ripple||!1===n.ripple},y.className),o=d({ref:P,id:y.id,className:t,style:y.style,onClick:Z},T.getOtherProps(y),M("root"));return e.createElement(r,{nodeRef:P,classNames:"p-connected-overlay",in:S,timeout:{enter:120,exit:100},options:y.transitionOptions,unmountOnExit:!0,onEnter:X,onEntered:U,onExit:V,onExited:Y},e.createElement("div",o,e.createElement(R,{menuProps:y,model:y.model,root:!0,popup:y.popup,onHide:L,isMobileMode:C,onItemToggle:_,submenuIcon:y.submenuIcon,ptm:M})))}();return y.popup?e.createElement(m,{element:$,appendTo:y.appendTo}):$})));Z.displayName="TieredMenu";export{Z as TieredMenu};
