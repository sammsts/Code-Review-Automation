import*as e from"react";import t,{ariaLabel as r,PrimeReactContext as n,FilterService as o}from"primereact/api";import{useMountEffect as i,useUpdateEffect as l}from"primereact/hooks";import{mergeProps as a,ObjectUtils as c,IconUtils as u,DomHandler as s,classNames as p,UniqueComponentId as m}from"primereact/utils";import{ComponentBase as f}from"primereact/componentbase";import{Button as d}from"primereact/button";import{AngleDoubleDownIcon as v}from"primereact/icons/angledoubledown";import{AngleDoubleUpIcon as g}from"primereact/icons/angledoubleup";import{AngleDownIcon as y}from"primereact/icons/angledown";import{AngleUpIcon as b}from"primereact/icons/angleup";import{SearchIcon as h}from"primereact/icons/search";import{Ripple as I}from"primereact/ripple";function E(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}function w(e){if(Array.isArray(e))return E(e)}function S(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}function O(e,t){if(e){if("string"==typeof e)return E(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);return"Object"===r&&e.constructor&&(r=e.constructor.name),"Map"===r||"Set"===r?Array.from(e):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?E(e,t):void 0}}function C(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function x(e){return w(e)||S(e)||O(e)||C()}function D(e){if(Array.isArray(e))return e}function T(e,t){var r=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=r){var n,o,i,l,a=[],c=!0,u=!1;try{if(i=(r=r.call(e)).next,0===t){if(Object(r)!==r)return;c=!1}else for(;!(c=(n=i.call(r)).done)&&(a.push(n.value),a.length!==t);c=!0);}catch(e){u=!0,o=e}finally{try{if(!c&&null!=r.return&&(l=r.return(),Object(l)!==l))return}finally{if(u)throw o}}return a}}function k(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function N(e,t){return D(e)||T(e,t)||O(e,t)||k()}var j=f.extend({defaultProps:{__TYPE:"OrderList",id:null,value:null,header:null,style:null,className:null,listStyle:null,dragdrop:!1,tabIndex:0,filterIcon:null,moveUpIcon:null,moveTopIcon:null,moveDownIcon:null,moveBottomIcon:null,dataKey:null,breakpoint:"960px",onChange:null,itemTemplate:null,filter:!1,filterBy:null,filterMatchMode:"contains",filterLocale:void 0,filterPlaceholder:null,filterTemplate:null,onFilter:null,children:void 0}}),K=e.memo((function(t){var n=t.moveUpIcon||e.createElement(b,null),o=t.moveTopIcon||e.createElement(g,null),i=t.moveDownIcon||e.createElement(y,null),l=t.moveBottomIcon||e.createElement(v,null),u=a({className:"p-orderlist-controls"},t.ptm("control")),s=a({type:"button",icon:n,onClick:function(e){if(t.selection){for(var r=x(t.value),n=0;n<t.selection.length;n++){var o=c.findIndexInList(t.selection[n],r,t.dataKey);if(0===o)break;var i=r[o-1];r[o-1]=r[o],r[o]=i}t.onReorder&&t.onReorder({originalEvent:e,value:r,direction:"up"})}},"aria-label":r("moveUp")},t.ptm("moveUpButton")),p=a({type:"button",icon:o,onClick:function(e){if(t.selection){for(var r=x(t.value),n=0;n<t.selection.length;n++){var o=c.findIndexInList(t.selection[n],r,t.dataKey);if(0===o)break;var i=r.splice(o,1)[0];r.unshift(i)}t.onReorder&&t.onReorder({originalEvent:e,value:r,direction:"top"})}},"aria-label":r("moveTop")},t.ptm("moveTopButton")),m=a({type:"button",icon:i,onClick:function(e){if(t.selection){for(var r=x(t.value),n=t.selection.length-1;n>=0;n--){var o=c.findIndexInList(t.selection[n],r,t.dataKey);if(o===r.length-1)break;var i=r[o+1];r[o+1]=r[o],r[o]=i}t.onReorder&&t.onReorder({originalEvent:e,value:r,direction:"down"})}},"aria-label":r("moveDown")},t.ptm("moveDownButton")),f=a({type:"button",icon:l,onClick:function(e){if(t.selection){for(var r=x(t.value),n=t.selection.length-1;n>=0;n--){var o=c.findIndexInList(t.selection[n],r,t.dataKey);if(o===r.length-1)break;var i=r.splice(o,1)[0];r.push(i)}t.onReorder&&t.onReorder({originalEvent:e,value:r,direction:"bottom"})}},"aria-label":r("moveBottom")},t.ptm("moveBottomButton"));return e.createElement("div",u,e.createElement(d,s),e.createElement(d,p),e.createElement(d,m),e.createElement(d,f))}));function L(e){return L="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},L(e)}function P(e,t){if("object"!==L(e)||null===e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var n=r.call(e,t||"default");if("object"!==L(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}function R(e){var t=P(e,"string");return"symbol"===L(t)?t:String(t)}function B(e,t,r){return(t=R(t))in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function F(){return F=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},F.apply(this,arguments)}function A(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function M(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?A(Object(r),!0).forEach((function(t){B(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):A(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}K.displayName="OrderListControls";var U=e.memo((function(t){var r,n,o,i=function(e,r){return t.ptm(r,{context:{selected:g(e)}})},l=e.useRef(null),m=e.useRef(null),f=e.useRef(null),d=e.useRef(null),v={filter:function(e){return t.onFilterInputChange(e)},reset:function(){return t.resetFilter()}},g=function(e){return-1!==c.findIndexInList(e,t.selection,t.dataKey)},y=function(e,t){m.current!==t&&m.current+1!==t&&(f.current=t,s.addClass(e.target,"p-orderlist-droppoint-highlight"),e.preventDefault())},b=function(e){f.current=null,s.removeClass(e.target,"p-orderlist-droppoint-highlight")},E=function(e){var r=m.current>f.current?f.current:0===f.current?0:f.current-1,n=x(t.value);c.reorderArray(n,m.current,r),f.current=null,s.removeClass(e.target,"p-orderlist-droppoint-highlight"),t.onChange&&t.onChange({originalEvent:e,value:n})},w=function(e){l.current=!1},S=function(e){if(l.current){var t=d.current.getBoundingClientRect().top+s.getWindowScrollTop(),r=t+d.current.clientHeight-e.pageY,n=e.pageY-t;r<25&&r>0?d.current.scrollTop+=15:n<25&&n>0&&(d.current.scrollTop-=15)}},O=function(e){13===e.which&&e.preventDefault()},C=function(r,n){var o=a({className:"p-orderlist-droppoint",onDragOver:function(e){return y(e,r+1)},onDragLeave:b,onDrop:E},t.ptm("droppoint"));return e.createElement("li",F({key:n},o))},D=(r=a({className:"p-orderlist-header"},t.ptm("header")),t.header?e.createElement("div",r,t.header):null),T=function(){var r=a({className:"p-orderlist-filter"},t.ptm("icon")),n=u.getJSXIcon(t.filterIcon||e.createElement(h,r),M({},r),{props:t});if(t.filter){var o=a({className:"p-orderlist-filter"},t.ptm("filter")),i=a({type:"text",value:t.filterValue,onChange:t.onFilter,onKeyDown:O,placeholder:t.placeholder,className:"p-orderlist-filter-input p-inputtext p-component"},t.ptm("filterInput")),l=a({className:"p-orderlist-filter-icon"},t.ptm("filterIcon")),s=e.createElement("div",o,e.createElement("input",i),e.createElement("span",l,n));if(t.filterTemplate)s=c.getJSXElement(t.filterTemplate,{className:"p-orderlist-filter",inputProps:{inputClassName:"p-orderlist-filter-input p-inputtext p-component",onChange:t.onFilter,onKeyDown:O},filterOptions:v,iconClassName:"p-orderlist-filter-icon",element:s,props:t});var p=a({className:"p-orderlist-filter-container"},t.ptm("filterContainer"));return e.createElement("div",p,s)}return null}(),k=(n=t.value?t.value.map((function(r,n){var o=t.itemTemplate?t.itemTemplate(r):r,c=p("p-orderlist-item",{"p-highlight":g(r)},t.className),u=JSON.stringify(r),s=a({className:c,onClick:function(e){return t.onItemClick({originalEvent:e,value:r,index:n})},onKeyDown:function(e){return t.onItemKeyDown({originalEvent:e,value:r,index:n})},role:"option","aria-selected":g(r),draggable:"true",onDragStart:function(e){return r=e,o=n,l.current=!0,m.current=o,void(t.dragdropScope&&r.dataTransfer.setData("text","orderlist"));var r,o},onDragEnd:w,tabIndex:t.tabIndex},i(r,"item"));if(t.dragdrop){var f=[];return 0===n&&f.push(C(r,n)),f.push(e.createElement("li",F({key:u},s),o,e.createElement(I,null))),f.push(C(n,u+"_droppoint")),f}var d=a({className:c,onClick:function(e){return t.onItemClick({originalEvent:e,value:r,index:n})},onKeyDown:function(e){return t.onItemKeyDown({originalEvent:e,value:r,index:n})},role:"option","aria-selected":g(r),tabIndex:t.tabIndex},i(r,"item"));return e.createElement("li",F({key:u},d),o)})):null,o=a({ref:d,className:"p-orderlist-list",style:t.listStyle,onDragOver:S,role:"listbox","aria-multiselectable":!0},t.ptm("list")),e.createElement("ul",o,n)),N=a({className:"p-orderlist-list-container"},t.ptm("container"));return e.createElement("div",N,D,T,k)}));U.displayName="OrderListSubList";var H=e.memo(e.forwardRef((function(r,u){var f=e.useContext(n),d=j.getProps(r,f),v=N(e.useState([]),2),g=v[0],y=v[1],b=N(e.useState(""),2),h=b[0],I=b[1],E=N(e.useState(null),2),w=E[0],S=E[1],O=c.isNotEmpty(h),C=e.useRef(null),D=e.useRef(null),T=e.useRef(null),k=j.setMetaData({props:d,state:{selection:g,filterValue:h,attributeSelector:w}}).ptm,L=function(e){var t,r=e.originalEvent.metaKey||e.originalEvent.ctrlKey,n=c.findIndexInList(e.value,g,d.dataKey);t=-1!==n?r?g.filter((function(e,t){return t!==n})):[e.value]:r?[].concat(x(g),[e.value]):[e.value],y(t)},P=function e(t){var r=t.nextElementSibling;return r?s.hasClass(r,"p-orderlist-item")?r:e(r):null},R=function e(t){var r=t.previousElementSibling;return r?s.hasClass(r,"p-orderlist-item")?r:e(r):null},B=function(){var e=s.findSingle(C.current,".p-orderlist-list"),t=s.find(e,".p-orderlist-item.p-highlight");if(t&&t.length)switch(T.current){case"up":s.scrollInView(e,t[0]);break;case"top":e.scrollTop=0;break;case"down":s.scrollInView(e,t[t.length-1]);break;case"bottom":setTimeout((function(){return e.scrollTop=e.scrollHeight}),100)}},F=function(){if(!D.current){D.current=s.createInlineStyle(f&&f.nonce||t.nonce);var e="\n@media screen and (max-width: ".concat(d.breakpoint,") {\n    .p-orderlist[").concat(w,"] {\n        flex-direction: column;\n    }\n\n    .p-orderlist[").concat(w,"] .p-orderlist-controls {\n        padding: var(--content-padding);\n        flex-direction: row;\n    }\n\n    .p-orderlist[").concat(w,"] .p-orderlist-controls .p-button {\n        margin-right: var(--inline-spacing);\n        margin-bottom: 0;\n    }\n\n    .p-orderlist[").concat(w,"] .p-orderlist-controls .p-button:last-child {\n        margin-right: 0;\n    }\n}\n");D.current.innerHTML=e}};e.useImperativeHandle(u,(function(){return{props:d,getElement:function(){return C.current}}})),i((function(){!w&&S(m())})),l((function(){return w&&(C.current.setAttribute(w,""),F()),function(){D.current=s.removeInlineStyle(D.current)}}),[w,d.breakpoint]),l((function(){T.current&&(B(),T.current=null)}));var A=p("p-orderlist p-component",d.className),M=function(){if(O){var e=h.trim().toLocaleLowerCase(d.filterLocale),t=d.filterBy?d.filterBy.split(","):[];return o.filter(d.value,t,e,d.filterMatchMode,d.filterLocale)}return d.value}(),H=a({ref:C,id:d.id,className:A,style:d.style},j.getOtherProps(d),k("root"));return e.createElement("div",H,e.createElement(K,{value:M,selection:g,onReorder:function(e){d.onChange&&d.onChange({event:e.originalEvent,value:e.value}),T.current=e.direction},dataKey:d.dataKey,moveUpIcon:d.moveUpIcon,moveTopIcon:d.moveTopIcon,moveDownIcon:d.moveDownIcon,moveBottomIcon:d.moveBottomIcon,ptm:k}),e.createElement(U,{value:M,selection:g,onItemClick:L,onItemKeyDown:function(e){var t=e.originalEvent,r=t.currentTarget;switch(t.which){case 40:var n=P(r);n&&n.focus(),t.preventDefault();break;case 38:var o=R(r);o&&o.focus(),t.preventDefault();break;case 13:L(e),t.preventDefault()}},onFilterInputChange:function(e){var t=e.target.value;I(t),d.onFilter&&d.onFilter({originalEvent:e,filter:t})},itemTemplate:d.itemTemplate,filter:d.filter,onFilter:function(e){var t=e.target.value;I(t),d.onFilter&&d.onFilter({originalEvent:e,value:t})},resetFilter:function(){I(""),d.onFilter&&d.onFilter({filter:""})},filterTemplate:d.filterTemplate,header:d.header,listStyle:d.listStyle,dataKey:d.dataKey,dragdrop:d.dragdrop,onChange:d.onChange,tabIndex:d.tabIndex,filterIcon:d.filterIcon,ptm:k}))})));H.displayName="OrderList";export{H as OrderList};
