import*as e from"react";import n,{PrimeReactContext as t}from"primereact/api";import{useOverlayListener as r,useEventListener as o,useMountEffect as i,useUpdateEffect as l,useUnmountEffect as u}from"primereact/hooks";import{OverlayService as a}from"primereact/overlayservice";import{Tooltip as c}from"primereact/tooltip";import{classNames as p,mergeProps as s,DomHandler as f,ObjectUtils as d,ZIndexUtils as m}from"primereact/utils";import{ComponentBase as b}from"primereact/componentbase";import{CSSTransition as h}from"primereact/csstransition";import{Portal as g}from"primereact/portal";function y(){return y=Object.assign?Object.assign.bind():function(e){for(var n=1;n<arguments.length;n++){var t=arguments[n];for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r])}return e},y.apply(this,arguments)}function v(e){return v="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},v(e)}function E(e,n){if("object"!==v(e)||null===e)return e;var t=e[Symbol.toPrimitive];if(void 0!==t){var r=t.call(e,n||"default");if("object"!==v(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===n?String:Number)(e)}function O(e){var n=E(e,"string");return"symbol"===v(n)?n:String(n)}function x(e,n,t){return(n=O(n))in e?Object.defineProperty(e,n,{value:t,enumerable:!0,configurable:!0,writable:!0}):e[n]=t,e}function w(e){if(Array.isArray(e))return e}function k(e,n){var t=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=t){var r,o,i,l,u=[],a=!0,c=!1;try{if(i=(t=t.call(e)).next,0===n){if(Object(t)!==t)return;a=!1}else for(;!(a=(r=i.call(t)).done)&&(u.push(r.value),u.length!==n);a=!0);}catch(e){c=!0,o=e}finally{try{if(!a&&null!=t.return&&(l=t.return(),Object(l)!==l))return}finally{if(c)throw o}}return u}}function M(e,n){(null==n||n>e.length)&&(n=e.length);for(var t=0,r=new Array(n);t<n;t++)r[t]=e[t];return r}function S(e,n){if(e){if("string"==typeof e)return M(e,n);var t=Object.prototype.toString.call(e).slice(8,-1);return"Object"===t&&e.constructor&&(t=e.constructor.name),"Map"===t||"Set"===t?Array.from(e):"Arguments"===t||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(t)?M(e,n):void 0}}function C(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function T(e,n){return w(e)||k(e,n)||S(e,n)||C()}var j=b.extend({defaultProps:{__TYPE:"ColorPicker",appendTo:null,autoFocus:!1,children:void 0,className:null,defaultColor:"ff0000",disabled:!1,format:"hex",id:null,inline:!1,inputClassName:null,inputId:null,inputRef:null,inputStyle:null,onChange:null,onHide:null,onShow:null,panelClassName:null,panelStyle:null,style:null,tabIndex:null,tooltip:null,tooltipOptions:null,transitionOptions:null,value:null}}),N=e.forwardRef((function(r,o){var i,l,u=e.useContext(t),a=(i=p("p-colorpicker-panel",r.panelClassName,{"p-colorpicker-overlay-panel":!r.inline,"p-disabled":r.disabled,"p-input-filled":u&&"filled"===u.inputStyle||"filled"===n.inputStyle,"p-ripple-disabled":u&&!1===u.ripple||!1===n.ripple}),l=s({ref:o,className:i,style:r.panelStyle,onClick:r.onClick},r.ptm("panel")),e.createElement(h,{nodeRef:o,classNames:"p-connected-overlay",in:r.in,timeout:{enter:120,exit:100},options:r.transitionOptions,unmountOnExit:!0,onEnter:r.onEnter,onEntered:r.onEntered,onExit:r.onExit,onExited:r.onExited},e.createElement("div",l,r.children)));return r.inline?a:e.createElement(g,{element:a,appendTo:r.appendTo})}));function P(e,n){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);n&&(r=r.filter((function(n){return Object.getOwnPropertyDescriptor(e,n).enumerable}))),t.push.apply(t,r)}return t}function R(e){for(var n=1;n<arguments.length;n++){var t=null!=arguments[n]?arguments[n]:{};n%2?P(Object(t),!0).forEach((function(n){x(e,n,t[n])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):P(Object(t)).forEach((function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))}))}return e}N.displayName="ColorPickerPanel";var I=e.memo(e.forwardRef((function(b,h){var g=e.useContext(t),v=j.getProps(b,g),E=T(e.useState(!1),2),O=E[0],x=E[1],w=j.setMetaData({props:v,state:{overlayVisible:O}}).ptm,k=e.useRef(null),M=e.useRef(null),S=e.useRef(v.inputRef),C=e.useRef(null),P=e.useRef(null),I=e.useRef(null),D=e.useRef(null),Y=e.useRef(!1),A=e.useRef(null),H=e.useRef(!1),F=T(r({target:k,overlay:M,listener:function(e,n){n.valid&&pe()},when:O}),2),z=F[0],B=F[1],X=T(o({type:"mousemove",listener:function(e){H.current&&ee(e),Y.current&&$(e)}}),2),Z=X[0],_=X[1],K=T(o({type:"mouseup",listener:function(){H.current=Y.current=!1,f.removeClass(k.current,"p-colorpicker-dragging"),_(),U()}}),2),L=K[0],U=K[1],V=function(e){v.disabled||(Y.current=!0,$(e),f.addClass(k.current,"p-colorpicker-dragging"))},$=function(e){var n=D.current.getBoundingClientRect().top+(window.pageYOffset||document.documentElement.scrollTop||document.body.scrollTop||0);A.current=me({h:Math.floor(360*(150-Math.max(0,Math.min(150,(e.pageY||e.changedTouches[0].pageY)-n)))/150),s:100,b:100}),ie(),ue(),ne()},q=function(e){v.disabled||(H.current=!0,ee(e),f.addClass(k.current,"p-colorpicker-dragging"),e.preventDefault())},G=function(e){H.current&&(ee(e),e.preventDefault()),Y.current&&($(e),e.preventDefault())},J=function(){H.current=!1,Y.current=!1,f.removeClass(k.current,"p-colorpicker-dragging"),W()},Q=function(){Z(),L()},W=function(){_(),U()},ee=function(e){var n=C.current.getBoundingClientRect(),t=n.top+(window.pageYOffset||document.documentElement.scrollTop||document.body.scrollTop||0),r=n.left+document.body.scrollLeft,o=Math.floor(100*Math.max(0,Math.min(150,(e.pageX||e.changedTouches[0].pageX)-r))/150),i=Math.floor(100*(150-Math.max(0,Math.min(150,(e.pageY||e.changedTouches[0].pageY)-t)))/150);A.current=me({h:A.current.h,s:o,b:i}),le(),ae(),ne()},ne=function(){switch(v.format){case"hex":oe(Ee(A.current));break;case"rgb":oe(ye(A.current));break;case"hsb":oe(A.current)}},te=function(e){var n;if(e)switch(v.format){case"hex":n=he(e);break;case"rgb":n=ge(e);break;case"hsb":n=e}else n=he(v.defaultColor);return n},re=function(e){A.current=te(e)},oe=function(e){v.onChange&&v.onChange({value:e,stopPropagation:function(){},preventDefault:function(){},target:{name:v.name,id:v.id,value:e}})},ie=function(){if(C.current){var e=me({h:A.current.h,s:100,b:100});C.current.style.backgroundColor="#"+Ee(e)}},le=function(){P.current&&(P.current.style.left=Math.floor(150*A.current.s/100)+"px",P.current.style.top=Math.floor(150*(100-A.current.b)/100)+"px")},ue=function(){I.current&&(I.current.style.top=Math.floor(150-150*A.current.h/360)+"px")},ae=function(){S.current&&(S.current.style.backgroundColor="#"+Ee(A.current))},ce=function(){x(!0)},pe=function(){x(!1)},se=function(){fe()},fe=function(){O?pe():ce()},de=function(e){switch(e.which){case 32:fe(),e.preventDefault();break;case 27:case 9:pe()}},me=function(e){return{h:Math.min(360,Math.max(0,e.h)),s:Math.min(100,Math.max(0,e.s)),b:Math.min(100,Math.max(0,e.b))}},be=function(e){var n=parseInt(e.indexOf("#")>-1?e.substring(1):e,16);return{r:n>>16,g:(65280&n)>>8,b:255&n}},he=function(e){return ge(be(e))},ge=function(e){var n={h:0,s:0,b:0},t=Math.min(e.r,e.g,e.b),r=Math.max(e.r,e.g,e.b),o=r-t;return n.b=r,n.s=0!==r?255*o/r:0,n.h=0!==n.s?e.r===r?(e.g-e.b)/o:e.g===r?2+(e.b-e.r)/o:4+(e.r-e.g)/o:-1,n.h*=60,n.h<0&&(n.h+=360),n.s*=100/255,n.b*=100/255,n},ye=function(e){var n={r:null,g:null,b:null},t=Math.round(e.h),r=Math.round(255*e.s/100),o=Math.round(255*e.b/100);if(0===r)n={r:o,g:o,b:o};else{var i=o,l=(255-r)*o/255,u=t%60*(i-l)/60;360===t&&(t=0),t<60?(n.r=i,n.b=l,n.g=l+u):t<120?(n.g=i,n.b=l,n.r=i-u):t<180?(n.g=i,n.r=l,n.b=l+u):t<240?(n.b=i,n.r=l,n.g=i-u):t<300?(n.b=i,n.g=l,n.r=l+u):t<360?(n.r=i,n.g=l,n.b=i-u):(n.r=0,n.g=0,n.b=0)}return{r:Math.round(n.r),g:Math.round(n.g),b:Math.round(n.b)}},ve=function(e){var n=[e.r.toString(16),e.g.toString(16),e.b.toString(16)];for(var t in n)1===n[t].length&&(n[t]="0"+n[t]);return n.join("")},Ee=function(e){return ve(ye(e))},Oe=function(){ue(),le(),ae(),ie()},xe=function(){S.current&&f.alignOverlay(M.current,S.current.parentElement,v.appendTo||g&&g.appendTo||n.appendTo)};e.useImperativeHandle(h,(function(){return{props:v,show:ce,hide:pe,focus:function(){return f.focus(S.current)},getElement:function(){return k.current},getOverlay:function(){return M.current},getInput:function(){return S.current}}})),e.useEffect((function(){d.combinedRefs(S,v.inputRef)}),[S,v.inputRef]),i((function(){re(v.value),Oe(),v.autoFocus&&f.focus(S.current,v.autoFocus)})),l((function(){H.current||Y.current||re(v.value)}),[v.value]),l((function(){Oe()})),u((function(){m.clear(M.current)}));var we,ke,Me,Se,Ce,Te,je,Ne,Pe=d.isNotEmpty(v.tooltip),Re=p("p-colorpicker p-component",{"p-colorpicker-overlay":!v.inline},v.className),Ie=(we=s({ref:C,className:"p-colorpicker-color-selector",onMouseDown:function(e){return n=e,void(v.disabled||(Q(),q(n)));var n},onTouchStart:function(e){return q(e)},onTouchMove:function(e){return G(e)},onTouchEnd:J},w("selector")),ke=s({className:"p-colorpicker-color"},w("color")),Me=s({ref:P,className:"p-colorpicker-color-handle"},w("colorHandler")),Te=e.createElement("div",we,e.createElement("div",ke,e.createElement("div",Me))),Se=s({ref:D,className:"p-colorpicker-hue",onMouseDown:function(e){return n=e,void(v.disabled||(Q(),V(n)));var n},onTouchStart:function(e){return V(e)},onTouchMove:function(e){return G(e)},onTouchEnd:J},w("hue")),Ce=s({ref:I,className:"p-colorpicker-hue-handle"},w("hueHandler")),je=e.createElement("div",Se,e.createElement("div",Ce)),Ne=s({className:"p-colorpicker-content"},w("content")),e.createElement("div",Ne,Te,je)),De=function(){if(!v.inline){var n=p("p-colorpicker-preview p-inputtext",v.inputClassName,{"p-disabled":v.disabled}),t=j.getOtherProps(v),r=s(R({ref:S,type:"text",readOnly:!0,className:n,style:v.inputStyle,id:v.inputId,tabIndex:v.tabIndex,disabled:v.disabled,onClick:se,onKeyDown:de},t),w("input"));return e.createElement("input",r)}return null}(),Ye=s({id:v.id,ref:k,style:v.style,className:Re},j.getOtherProps(v),w("root"));return e.createElement(e.Fragment,null,e.createElement("div",Ye,De,e.createElement(N,{ref:M,appendTo:v.appendTo,inline:v.inline,disabled:v.disabled,panelStyle:v.panelStyle,panelClassName:v.panelClassName,onClick:function(e){v.inline||a.emit("overlay-click",{originalEvent:e,target:k.current})},in:v.inline||O,onEnter:function(){m.set("overlay",M.current,g&&g.autoZIndex||n.autoZIndex,g&&g.zIndex.overlay||n.zIndex.overlay),xe()},onEntered:function(){z(),v.onShow&&v.onShow()},onExit:function(){B()},onExited:function(){m.clear(M.current),v.onHide&&v.onHide()},transitionOptions:v.transitionOptions,ptm:w},Ie)),Pe&&e.createElement(c,y({target:k,content:v.tooltip},v.tooltipOptions,{pt:w("tooltip")})))})));I.displayName="ColorPicker";export{I as ColorPicker};
