import*as e from"react";import t,{PrimeReactContext as n,localeOption as r}from"primereact/api";import{Button as o}from"primereact/button";import{useOverlayListener as l,useMountEffect as i,useUpdateEffect as a,useUnmountEffect as u}from"primereact/hooks";import{ChevronDownIcon as c}from"primereact/icons/chevrondown";import{SpinnerIcon as p}from"primereact/icons/spinner";import{TimesCircleIcon as s}from"primereact/icons/timescircle";import{InputText as m}from"primereact/inputtext";import{OverlayService as f}from"primereact/overlayservice";import{Tooltip as d}from"primereact/tooltip";import{classNames as g,mergeProps as v,ObjectUtils as y,UniqueComponentId as b,DomHandler as h,ZIndexUtils as E,IconUtils as w}from"primereact/utils";import{ComponentBase as C}from"primereact/componentbase";import{CSSTransition as O}from"primereact/csstransition";import{Portal as S}from"primereact/portal";import{Ripple as x}from"primereact/ripple";import{VirtualScroller as k}from"primereact/virtualscroller";function I(e){return I="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},I(e)}function D(e,t){if("object"!==I(e)||null===e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var r=n.call(e,t||"default");if("object"!==I(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}function N(e){var t=D(e,"string");return"symbol"===I(t)?t:String(t)}function j(e,t,n){return(t=N(t))in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function P(){return P=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e},P.apply(this,arguments)}function T(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function M(e){if(Array.isArray(e))return T(e)}function F(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}function L(e,t){if(e){if("string"==typeof e)return T(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?T(e,t):void 0}}function R(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function A(e){if(Array.isArray(e))return e}function G(e,t){var n=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=n){var r,o,l,i,a=[],u=!0,c=!1;try{if(l=(n=n.call(e)).next,0===t){if(Object(n)!==n)return;u=!1}else for(;!(u=(r=l.call(n)).done)&&(a.push(r.value),a.length!==t);u=!0);}catch(e){c=!0,o=e}finally{try{if(!u&&null!=n.return&&(i=n.return(),Object(i)!==i))return}finally{if(c)throw o}}return a}}function K(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function H(e,t){return A(e)||G(e,t)||L(e,t)||K()}var U=C.extend({defaultProps:{__TYPE:"AutoComplete",id:null,appendTo:null,autoFocus:!1,autoHighlight:!1,className:null,completeMethod:null,delay:300,disabled:!1,dropdown:!1,dropdownAriaLabel:null,dropdownAutoFocus:!0,dropdownIcon:null,dropdownMode:"blank",emptyMessage:null,field:null,forceSelection:!1,inputClassName:null,inputId:null,inputRef:null,inputStyle:null,itemTemplate:null,loadingIcon:null,maxLength:null,minLength:1,multiple:!1,name:null,onBlur:null,onChange:null,onClear:null,onClick:null,onContextMenu:null,onDblClick:null,onDropdownClick:null,onFocus:null,onHide:null,onKeyPress:null,onKeyUp:null,onMouseDown:null,onSelect:null,onShow:null,onUnselect:null,optionGroupChildren:null,optionGroupLabel:null,optionGroupTemplate:null,panelClassName:null,panelFooterTemplate:null,panelStyle:null,placeholder:null,readOnly:!1,removeTokenIcon:null,scrollHeight:"200px",selectedItemTemplate:null,selectionLimit:null,showEmptyMessage:!1,size:null,style:null,suggestions:null,tabIndex:null,tooltip:null,tooltipOptions:null,transitionOptions:null,type:"text",value:null,virtualScrollerOptions:null,children:void 0}});function _(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function z(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?_(Object(n),!0).forEach((function(t){j(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):_(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var J=e.memo(e.forwardRef((function(o,l){var i,a,u,c,p,s=e.useContext(n),m=function(e,t){return o.ptm(t,{context:{selected:o.selectedItem.current===e}})},f=function(){if(o.panelFooterTemplate){var t=y.getJSXElement(o.panelFooterTemplate,o,o.onOverlayHide),n=v({className:"p-autocomplete-footer"},o.ptm("footer"));return e.createElement("div",n,t)}return null},d=function(t,n,r){return o.getOptionGroupChildren(t).map((function(t,l){var i=n+"_"+l,a=o.selectedItem===t,u=o.itemTemplate?y.getJSXElement(o.itemTemplate,t,l):o.field?y.resolveFieldData(t,o.field):t,c=g("p-autocomplete-item",{"p-disabled":t.disabled}),p=v({role:"option","aria-selected":a,className:c,style:r,onClick:function(e){return o.onItemClick(e,t)},"data-group":n,"data-index":l},m(t,"item"));return e.createElement("li",P({key:i},p),u,e.createElement(x,null))}))},b=function(t,n){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},l={height:r.props?r.props.itemSize:void 0};if(o.optionGroupLabel){var i=o.optionGroupTemplate?y.getJSXElement(o.optionGroupTemplate,t,n):o.getOptionGroupLabel(t),a=d(t,n,l),u=n+"_"+y.resolveFieldData(t,o.optionGroupLabel),c=v({className:"p-autocomplete-item-group",style:l},o.ptm("itemGroup"));return e.createElement(e.Fragment,{key:u},e.createElement("li",c,i),a)}var p=o.itemTemplate?y.getJSXElement(o.itemTemplate,t,n):o.field?y.resolveFieldData(t,o.field):t,s=g("p-autocomplete-item",{"p-disabled":t.disabled}),f=v({role:"option","aria-selected":o.selectedItem===t,className:s,style:l,onClick:function(e){return o.onItemClick(e,t)}},m(t,"item"));return e.createElement("li",P({key:n},f),p,e.createElement(x,null))},h=function(){if(o.showEmptyMessage&&y.isEmpty(o.suggestions)){var t=o.emptyMessage||r("emptyMessage"),n=v({className:"p-autocomplete-item"},o.ptm("emptyMesage")),l=v({className:"p-autocomplete-items"},o.ptm("list"));return e.createElement("ul",l,e.createElement("li",n,t))}if(o.virtualScrollerOptions){var i=z(z({},o.virtualScrollerOptions),{style:z(z({},o.virtualScrollerOptions.style),{height:o.scrollHeight}),autoSize:!0,items:o.suggestions,itemTemplate:function(e,t){return e&&b(e,t.index,t)},contentTemplate:function(t){var n=g("p-autocomplete-items",t.className),r=v({id:o.listId,ref:t.contentRef,style:t.style,className:n,role:"listbox"},o.ptm("list"));return e.createElement("ul",r,t.children)}});return e.createElement(k,P({ref:o.virtualScrollerRef},i,{pt:o.ptm("virtualScroller")}))}var a=o.suggestions?o.suggestions.map(b):null,u=v({id:o.listId,className:"p-autocomplete-items",role:"listbox"},o.ptm("list")),c=v({className:"p-autocomplete-items-wrapper",style:{maxHeight:o.scrollHeight||"auto"}},o.ptm("listWrapper"));return e.createElement("div",c,e.createElement("ul",u,a))},E=(i=g("p-autocomplete-panel p-component",o.panelClassName,{"p-input-filled":s&&"filled"===s.inputStyle||"filled"===t.inputStyle,"p-ripple-disabled":s&&!1===s.ripple||!1===t.ripple}),a=z({},o.panelStyle||{}),u=h(),c=f(),p=v({ref:l,className:i,style:a,onClick:function(e){return o.onClick(e)}},o.ptm("panel")),e.createElement(O,{nodeRef:l,classNames:"p-connected-overlay",in:o.in,timeout:{enter:120,exit:100},options:o.transitionOptions,unmountOnExit:!0,onEnter:o.onEnter,onEntering:o.onEntering,onEntered:o.onEntered,onExit:o.onExit,onExited:o.onExited},e.createElement("div",p,u,c)));return e.createElement(S,{element:E,appendTo:o.appendTo})})));function X(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function B(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?X(Object(n),!0).forEach((function(t){j(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):X(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}J.displayName="AutoCompletePanel";var V=e.memo(e.forwardRef((function(C,O){var S=e.useContext(n),x=U.getProps(C,S),k=H(e.useState(x.id),2),I=k[0],D=k[1],N=H(e.useState(!1),2),j=N[0],T=N[1],A=H(e.useState(!1),2),G=A[0],K=A[1],_=H(e.useState(!1),2),z=_[0],X=_[1],V=U.setMetaData({props:x,state:{id:I,searching:j,focused:G,overlayVisible:z}}).ptm,q=e.useRef(null),Z=e.useRef(null),W=e.useRef(x.inputRef),Y=e.useRef(null),$=e.useRef(null),Q=e.useRef(null),ee=e.useRef(null),te=H(l({target:q,overlay:Z,listener:function(e,t){t.valid&&("outside"===t.type?!oe(e)&&me():me())},when:z}),2),ne=te[0],re=te[1],oe=function(e){return x.multiple?e.target===Y.current||Y.current.contains(e.target):e.target===W.current},le=function(e){Q.current&&clearTimeout(Q.current);var t=e.target.value;x.multiple||ue(e,t),y.isEmpty(t)?(me(),x.onClear&&x.onClear(e)):t.length>=x.minLength?Q.current=setTimeout((function(){ie(e,t,"input")}),x.delay):me()},ie=function(e,t,n){null!=t&&("input"===n&&0===t.trim().length||x.completeMethod&&(T(!0),x.completeMethod({originalEvent:e,query:t})))},ae=function(e,t,n){if(x.multiple){if(W.current.value="",!ke(t)&&(!x.value||!x.selectionLimit||x.value.length<x.selectionLimit)){var r=x.value?[].concat(M(o=x.value)||F(o)||L(o)||R(),[t]):[t];ue(e,r)}}else pe(t),ue(e,t);var o;x.onSelect&&x.onSelect({originalEvent:e,value:t}),n||(h.focus(W.current),me())},ue=function(e,t){ee&&y.deepEquals(ee.current,t)||(x.onChange&&x.onChange({originalEvent:e,value:t,stopPropagation:function(){e.stopPropagation()},preventDefault:function(){e.preventDefault()},target:{name:x.name,id:I,value:t}}),ee.current=t)},ce=function(e){if(e){if("string"==typeof e)return e;if(x.selectedItemTemplate){var t=y.getJSXElement(x.selectedItemTemplate,e);return t||e}if(x.field){var n=y.resolveFieldData(e,x.field);return null!=n?n:e}return e}return""},pe=function(e){W.current.value=ce(e)},se=function(){X(!0)},me=function(){X(!1),T(!1)},fe=function(){h.alignOverlay(Z.current,x.multiple?Y.current:W.current,x.appendTo||S&&S.appendTo||t.appendTo)},de=function(e){x.dropdownAutoFocus&&h.focus(W.current,x.dropdownAutoFocus),"blank"===x.dropdownMode?ie(e,"","dropdown"):"current"===x.dropdownMode&&ie(e,W.current.value,"dropdown"),x.onDropdownClick&&x.onDropdownClick({originalEvent:e,query:W.current.value})},ge=function(e,t){var n=x.value[t],r=x.value.filter((function(e,n){return t!==n}));ue(e,r),x.onUnselect&&x.onUnselect({originalEvent:e,value:n})},ve=function(e){if(z){var t=h.findSingle(Z.current,"li.p-highlight");switch(e.which){case 40:if(t){var n=be(t);n&&(h.addClass(n,"p-highlight"),h.removeClass(t,"p-highlight"),h.scrollInView(Ie(),n))}else t=h.findSingle(Z.current,"li"),h.hasClass(t,"p-autocomplete-item-group")&&(t=be(t)),t&&h.addClass(t,"p-highlight");e.preventDefault();break;case 38:if(t){var r=he(t);r&&(h.addClass(r,"p-highlight"),h.removeClass(t,"p-highlight"),h.scrollInView(Ie(),r))}e.preventDefault();break;case 13:t&&(ye(e,t),me(),e.preventDefault());break;case 27:me(),e.preventDefault();break;case 9:t&&ye(e,t),me()}}if(x.multiple&&8===e.which)if(x.value&&x.value.length&&!W.current.value){var o=x.value[x.value.length-1],l=x.value.slice(0,-1);ue(e,l),x.onUnselect&&x.onUnselect({originalEvent:e,value:o})}},ye=function(e,t){x.optionGroupLabel?ae(e,De(x.suggestions[t.dataset.group])[t.dataset.index]):ae(e,x.suggestions[h.index(t)])},be=function e(t){var n=t.nextElementSibling;return n?h.hasClass(n,"p-autocomplete-item-group")?e(n):n:null},he=function e(t){var n=t.previousElementSibling;return n?h.hasClass(n,"p-autocomplete-item-group")?e(n):n:null},Ee=function(e){K(!0),x.onFocus&&x.onFocus(e)},we=function(e){if(x.multiple)W.current.value="";else{var t=e.target.value.trim(),n=(x.suggestions||[]).find((function(e){var n=x.field?y.resolveFieldData(e,x.field):e;return n&&t===n.trim()}));n?ae(e,n,!0):(W.current.value="",ue(e,null),x.onClear&&x.onClear(e))}},Ce=function(e){K(!1),x.forceSelection&&we(e),x.onBlur&&x.onBlur(e)},Oe=function(e){h.focus(W.current),x.onClick&&x.onClick(e)},Se=function(e){Ee(e),h.addClass(Y.current,"p-focus")},xe=function(e){Ce(e),h.removeClass(Y.current,"p-focus")},ke=function(e){return!!x.value&&x.value.some((function(t){return y.equals(t,e)}))},Ie=function(){return $.current?Z.current.firstChild:Z.current},De=function(e){return y.resolveFieldData(e,x.optionGroupChildren)};e.useEffect((function(){y.combinedRefs(W,x.inputRef)}),[W,x.inputRef]),i((function(){I||D(b()),x.autoFocus&&h.focus(W.current,x.autoFocus)})),a((function(){j&&(y.isNotEmpty(x.suggestions)||x.showEmptyMessage?se():me(),T(!1))}),[x.suggestions]),a((function(){W.current&&!x.multiple&&pe(x.value),z&&fe()})),u((function(){Q.current&&clearTimeout(Q.current),E.clear(Z.current)})),e.useImperativeHandle(O,(function(){return{props:x,search:ie,show:se,hide:me,focus:function(){return h.focus(W.current)},getElement:function(){return q.current},getOverlay:function(){return Z.current},getInput:function(){return W.current},getVirtualScroller:function(){return $.current}}}));var Ne=function(){var t=ce(x.value),n=z?I+"_list":null,r=g("p-autocomplete-input",x.inputClassName,{"p-autocomplete-dd-input":x.dropdown});return e.createElement(m,P({ref:W,id:x.inputId,type:x.type,name:x.name,defaultValue:t,role:"combobox","aria-autocomplete":"list","aria-controls":n,"aria-haspopup":"listbox","aria-expanded":z,className:r,style:x.inputStyle,autoComplete:"off",readOnly:x.readOnly,disabled:x.disabled,placeholder:x.placeholder,size:x.size,maxLength:x.maxLength,tabIndex:x.tabIndex,onBlur:Ce,onFocus:Ee,onChange:le,onMouseDown:x.onMouseDown,onKeyUp:x.onKeyUp,onKeyDown:ve,onKeyPress:x.onKeyPress,onContextMenu:x.onContextMenu,onClick:x.onClick,onDoubleClick:x.onDblClick,pt:V("input")},Fe))},je=function(){var t,n,r,o=g("p-autocomplete-multiple-container p-component p-inputtext",{"p-disabled":x.disabled}),l=y.isNotEmpty(x.value)?x.value.map((function(t,n){var r=n+"multi-item",o=v({className:"p-autocomplete-token-icon",onClick:function(e){return ge(e,n)}},V("removeTokenIcon")),l=!x.disabled&&w.getJSXIcon(x.removeTokenIcon||e.createElement(s,o),B({},o),{props:x}),i=v({className:"p-autocomplete-token p-highlight"},V("token")),a=v({className:"p-autocomplete-token-label"},V("tokenLabel"));return e.createElement("li",P({key:r},i),e.createElement("span",a,ce(t)),l)})):null,i=(t=z?I+"_list":null,n=v({className:"p-autocomplete-input-token"},V("inputToken")),r=v(B({id:x.inputId,ref:W,type:x.type,disabled:x.disabled,placeholder:x.placeholder,role:"combobox","aria-autocomplete":"list","aria-controls":t,"aria-haspopup":"listbox","aria-expanded":z,autoComplete:"off",readOnly:x.readOnly,tabIndex:x.tabIndex,onChange:le,name:x.name,style:x.inputStyle,className:x.inputClassName,maxLength:x.maxLength,onKeyUp:x.onKeyUp,onKeyDown:ve,onKeyPress:x.onKeyPress,onFocus:Se,onBlur:xe},Fe),V("input")),e.createElement("li",n,e.createElement("input",r))),a=v({ref:Y,className:o,onClick:Oe,onContextMenu:x.onContextMenu,onMouseDown:x.onMouseDown,onDoubleClick:x.onDblClick},V("container"));return e.createElement("ul",a,l,i)},Pe=I+"_list",Te=y.isNotEmpty(x.tooltip),Me=U.getOtherProps(x),Fe=y.reduceKeys(Me,h.ARIA_PROPS),Le=g("p-autocomplete p-component p-inputwrapper",{"p-autocomplete-dd":x.dropdown,"p-autocomplete-multiple":x.multiple,"p-inputwrapper-filled":x.value,"p-inputwrapper-focus":G},x.className),Re=function(){if(j){var t=v({className:"p-autocomplete-loader p-icon-spin"},V("loadingIcon"));return w.getJSXIcon(x.loadingIcon||e.createElement(p,t),B({},t),{props:x})}return null}(),Ae=x.multiple?je():Ne(),Ge=function(){if(x.dropdown){var t=x.dropdownAriaLabel||x.placeholder||r("choose");return e.createElement(o,{type:"button",icon:x.dropdownIcon||e.createElement(c,null),className:"p-autocomplete-dropdown",disabled:x.disabled,onClick:de,"aria-label":t,pt:V("dropdownButton")})}return null}(),Ke=v({id:I,ref:q,style:x.style,className:Le},Me,V("root"));return e.createElement(e.Fragment,null,e.createElement("span",Ke,Ae,Re,Ge,e.createElement(J,P({ref:Z,virtualScrollerRef:$},x,{listId:Pe,onItemClick:ae,selectedItem:ee,onClick:function(e){f.emit("overlay-click",{originalEvent:e,target:q.current})},getOptionGroupLabel:function(e){return x.optionGroupLabel?y.resolveFieldData(e,x.optionGroupLabel):e},getOptionGroupChildren:De,in:z,onEnter:function(){E.set("overlay",Z.current,S&&S.autoZIndex||t.autoZIndex,S&&S.zIndex.overlay||t.zIndex.overlay),fe()},onEntering:function(){if(x.autoHighlight&&x.suggestions&&x.suggestions.length){var e=Ie().firstChild.firstChild;h.addClass(e,"p-highlight")}},onEntered:function(){ne(),x.onShow&&x.onShow()},onExit:function(){re()},onExited:function(){E.clear(Z.current),x.onHide&&x.onHide()},ptm:V}))),Te&&e.createElement(d,P({target:q,content:x.tooltip},x.tooltipOptions,{pt:V("tooltip")})))})));V.displayName="AutoComplete";export{V as AutoComplete};
