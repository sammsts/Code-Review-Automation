import*as e from"react";import{PrimeReactContext as t,FilterService as r,localeOption as n}from"primereact/api";import{useMountEffect as l}from"primereact/hooks";import{Tooltip as o}from"primereact/tooltip";import{mergeProps as i,IconUtils as a,ObjectUtils as u,classNames as c,DomHandler as s}from"primereact/utils";import{VirtualScroller as p}from"primereact/virtualscroller";import{ComponentBase as f}from"primereact/componentbase";import{SearchIcon as m}from"primereact/icons/search";import{InputText as d}from"primereact/inputtext";import{Ripple as b}from"primereact/ripple";function v(){return v=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},v.apply(this,arguments)}function y(e){return y="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},y(e)}function g(e,t){if("object"!==y(e)||null===e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var n=r.call(e,t||"default");if("object"!==y(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}function h(e){var t=g(e,"string");return"symbol"===y(t)?t:String(t)}function O(e,t,r){return(t=h(t))in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function E(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}function S(e){if(Array.isArray(e))return E(e)}function x(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}function P(e,t){if(e){if("string"==typeof e)return E(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);return"Object"===r&&e.constructor&&(r=e.constructor.name),"Map"===r||"Set"===r?Array.from(e):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?E(e,t):void 0}}function j(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function w(e){return S(e)||x(e)||P(e)||j()}function I(e){if(Array.isArray(e))return e}function D(e,t){var r=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=r){var n,l,o,i,a=[],u=!0,c=!1;try{if(o=(r=r.call(e)).next,0===t){if(Object(r)!==r)return;u=!1}else for(;!(u=(n=o.call(r)).done)&&(a.push(n.value),a.length!==t);u=!0);}catch(e){c=!0,l=e}finally{try{if(!u&&null!=r.return&&(i=r.return(),Object(i)!==i))return}finally{if(c)throw l}}return a}}function C(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var T=f.extend({defaultProps:{__TYPE:"ListBox",className:null,dataKey:null,disabled:null,emptyFilterMessage:null,emptyMessage:null,filter:!1,filterIcon:null,filterBy:null,filterInputProps:null,filterLocale:void 0,filterMatchMode:"contains",filterPlaceholder:null,filterTemplate:null,filterValue:null,id:null,itemTemplate:null,listClassName:null,listStyle:null,metaKeySelection:!1,multiple:!1,onChange:null,onFilterValueChange:null,optionDisabled:null,optionGroupChildren:null,optionGroupLabel:null,optionGroupTemplate:null,optionLabel:null,optionValue:null,options:null,style:null,tabIndex:0,tooltip:null,tooltipOptions:null,value:null,virtualScrollerOptions:null,children:void 0}});function F(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function N(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?F(Object(r),!0).forEach((function(t){O(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):F(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}var L=e.memo((function(t){var r={filter:function(e){return n(e)},reset:function(){return t.resetFilter()}},n=function(e){t.onFilter&&t.onFilter({originalEvent:e,value:e.target.value})},l=function(){var l=i({className:"p-listbox-filter-icon"},t.ptm("filterIcon")),o=a.getJSXIcon(t.filterIcon||e.createElement(m,l),N({},l),{props:t}),c=i({className:"p-listbox-header"},t.ptm("header")),s=i({className:"p-listbox-filter-container"},t.ptm("filterContainer")),p=e.createElement("div",s,e.createElement(d,v({type:"text",value:t.filter,onChange:n,className:"p-listbox-filter",disabled:t.disabled,placeholder:t.filterPlaceholder},t.filterInputProps,{pt:t.ptm("filterInput")})),o);t.filterTemplate&&(p=u.getJSXElement(t.filterTemplate,{className:"p-listbox-filter-container",element:p,filterOptions:r,filterInputChange:n,filterIconClassName:"p-dropdown-filter-icon",props:t}));return e.createElement("div",c,p)}();return e.createElement(e.Fragment,null,l)}));L.displayName="ListBoxHeader";var A=e.memo((function(t){var r=function(e){t.onClick&&t.onClick({originalEvent:e,option:t.option}),e.preventDefault()},n=function e(t){var r=t.nextElementSibling;return r?s.hasClass(r,"p-disabled")||s.hasClass(r,"p-listbox-item-group")?e(r):r:null},l=function e(t){var r=t.previousElementSibling;return r?s.hasClass(r,"p-disabled")||s.hasClass(r,"p-listbox-item-group")?e(r):r:null},o=c("p-listbox-item",{"p-highlight":t.selected,"p-disabled":t.disabled},t.option.className),a=t.template?u.getJSXElement(t.template,t.option):t.label,p=i({className:o,style:t.style,onClick:r,onTouchEnd:function(e){t.onTouchEnd&&t.onTouchEnd({originalEvent:e,option:t.option})},onKeyDown:function(e){var t=e.currentTarget;switch(e.which){case 40:var o=n(t);o&&o.focus(),e.preventDefault();break;case 38:var i=l(t);i&&i.focus(),e.preventDefault();break;case 13:r(e),e.preventDefault()}},tabIndex:"-1","aria-label":t.label,key:t.label,role:"option","aria-selected":t.selected,"aria-disabled":t.disabled},t.ptm("item",{context:{selected:t.selected,disabled:t.disabled}}));return e.createElement("li",p,a,e.createElement(b,null))}));function M(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function k(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?M(Object(r),!0).forEach((function(t){O(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):M(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}function K(e,t){var r="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!r){if(Array.isArray(e)||(r=G(e))||t&&e&&"number"==typeof e.length){r&&(e=r);var n=0,l=function(){};return{s:l,n:function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}},e:function(e){throw e},f:l}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var o,i=!0,a=!1;return{s:function(){r=r.call(e)},n:function(){var e=r.next();return i=e.done,e},e:function(e){a=!0,o=e},f:function(){try{i||null==r.return||r.return()}finally{if(a)throw o}}}}function G(e,t){if(e){if("string"==typeof e)return V(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);return"Object"===r&&e.constructor&&(r=e.constructor.name),"Map"===r||"Set"===r?Array.from(e):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?V(e,t):void 0}}function V(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}A.displayName="ListBoxItem";var B=e.memo(e.forwardRef((function(a,f){var m,d,b=e.useContext(t),y=T.getProps(a,b),g=e.useState(""),h=(d=2,I(m=g)||D(m,d)||P(m,d)||C()),O=h[0],E=h[1],S=e.useRef(null),x=e.useRef(null),j=e.useRef(!1),F=(y.onFilterValueChange?y.filterValue:O)||"",N=F&&F.trim().length>0,M=T.setMetaData({props:y,state:{filterValue:F}}).ptm,G=function(e){var t=e.option;y.disabled||Z(t)||(y.multiple?R(e.originalEvent,t):B(e.originalEvent,t),j.current=!1)},V=function(){y.disabled||(j.current=!0)},B=function(e,t){var r=$(t),n=!1,l=null;!j.current&&y.metaKeySelection?r?(e.metaKey||e.ctrlKey)&&(l=null,n=!0):(l=Q(t),n=!0):(l=r?null:Q(t),n=!0);n&&X(e,l)},R=function(e,t){var r=$(t),n=!1,l=null;if(!j&&y.metaKeySelection){var o=e.metaKey||e.ctrlKey;r?(l=o?q(t):[Q(t)],n=!0):(l=[].concat(w(l=o&&y.value||[]),[Q(t)]),n=!0)}else l=r?q(t):[].concat(w(y.value||[]),[Q(t)]),n=!0;n&&y.onChange({originalEvent:e,value:l,stopPropagation:function(){e.stopPropagation()},preventDefault:function(){e.preventDefault()},target:{name:y.name,id:y.id,value:l}})},_=function(e){x.current&&x.current.scrollToIndex(0);var t=e.value;y.onFilterValueChange?y.onFilterValueChange({originalEvent:e.originalEvent,value:t}):E(t)},J=function(){E(""),y.onFilter&&y.onFilter({filter:""})},X=function(e,t){y.onChange&&y.onChange({originalEvent:e,value:t,stopPropagation:function(){e.stopPropagation()},preventDefault:function(){e.preventDefault()},target:{name:y.name,id:y.id,value:t}})},q=function(e){return y.value.filter((function(t){return!u.equals(t,Q(e),y.dataKey)}))},z=function(){if(null!=y.value&&ie){if(!y.optionGroupLabel)return U(y.value,ie);for(var e=0;e<ie.length;e++){var t=U(y.value,te(ie[e]));if(-1!==t)return{group:e,option:t}}}return-1},H=function(){return y.optionValue?null:y.dataKey},U=function(e,t){var r=H();return t.findIndex((function(t){return u.equals(e,Q(t),r)}))},$=function(e){var t=Q(e),r=H();return y.multiple&&y.value?y.value.some((function(e){return u.equals(e,t,r)})):u.equals(y.value,t,r)},Y=function(e){return y.optionLabel?u.resolveFieldData(e,y.optionLabel):e&&void 0!==e.label?e.label:e},Q=function(e){return y.optionValue?u.resolveFieldData(e,y.optionValue):e&&void 0!==e.value?e.value:e},W=function(e){return y.dataKey?u.resolveFieldData(e,y.dataKey):Y(e)},Z=function(e){return y.optionDisabled?u.isFunction(y.optionDisabled)?y.optionDisabled(e):u.resolveFieldData(e,y.optionDisabled):!(!e||void 0===e.disabled)&&e.disabled},ee=function(e){return u.resolveFieldData(e,y.optionGroupLabel)},te=function(e){return u.resolveFieldData(e,y.optionGroupChildren)},re=function(){if(x.current){var e=z();-1!==e&&setTimeout((function(){return x.current.scrollToIndex(e)}),0)}};e.useImperativeHandle(f,(function(){return{props:y,focus:function(){return s.focusFirstElement(S.current)},getElement:function(){return S.current},getVirtualScroller:function(){return x.current}}})),l((function(){re()}));var ne=function(t,r){return te(t).map((function(t,n){var l=Y(t),o=n+"_"+W(t),i=Z(t),a=i?null:y.tabIndex||0;return e.createElement(A,{key:o,label:l,option:t,style:r,template:y.itemTemplate,selected:$(t),onClick:G,onTouchEnd:V,tabIndex:a,disabled:i,ptm:M})}))},le=function(t,r){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},l={height:n.props?n.props.itemSize:void 0};if(y.optionGroupLabel){var o=y.optionGroupTemplate?u.getJSXElement(y.optionGroupTemplate,t,r):u.resolveFieldData(t,y.optionGroupLabel),a=ne(t,l),c=r+"_"+ee(t),s=i({className:"p-listbox-item-group",style:l,role:"group"},M("itemGroup"));return e.createElement(e.Fragment,{key:c},e.createElement("li",s,o),a)}var p=Y(t),f=r+"_"+W(t),m=Z(t),d=m?null:y.tabIndex||0;return e.createElement(A,{key:f,label:p,option:t,style:l,template:y.itemTemplate,selected:$(t),onClick:G,onTouchEnd:V,tabIndex:d,disabled:m,ptm:M})},oe=function(t,r){var l=i({className:"p-listbox-empty-message"},M("emptyMessage")),o=u.getJSXElement(t,y)||n(r?"emptyFilterMessage":"emptyMessage");return e.createElement("li",l,o)},ie=function(){if(N){var e=F.trim().toLocaleLowerCase(y.filterLocale),t=y.filterBy?y.filterBy.split(","):[y.optionLabel||"label"];if(y.optionGroupLabel){var n,l=[],o=K(y.options);try{for(o.s();!(n=o.n()).done;){var i=n.value,a=r.filter(te(i),t,e,y.filterMatchMode,y.filterLocale);a&&a.length&&l.push(k(k({},i),{items:a}))}}catch(e){o.e(e)}finally{o.f()}return l}return r.filter(y.options,t,e,y.filterMatchMode,y.filterLocale)}return y.options}(),ae=u.isNotEmpty(y.tooltip),ue=T.getOtherProps(y),ce=u.reduceKeys(ue,s.ARIA_PROPS),se=c("p-listbox p-component",{"p-disabled":y.disabled},y.className),pe=c("p-listbox-list-wrapper",y.listClassName),fe=function(){if(y.virtualScrollerOptions){var t=k(k({},y.virtualScrollerOptions),{items:ie,onLazyLoad:function(e){return y.virtualScrollerOptions.onLazyLoad(k(k({},e),{filter:ie}))},itemTemplate:function(e,t){return e&&le(e,t.index,t)},contentTemplate:function(t){var r=c("p-listbox-list",t.className),n=i(k({ref:t.contentRef,style:t.style,className:r,role:"listbox","aria-multiselectable":y.multiple},ce),M("list"));return e.createElement("ul",n,t.children)}});return e.createElement(p,v({ref:x},t,{pt:M("virtualScroller")}))}var r=u.isNotEmpty(ie)?ie.map(le):N?oe(y.emptyFilterMessage,!0):oe(y.emptyMessage),n=i(k({className:"p-listbox-list",role:"listbox","aria-multiselectable":y.multiple},ce),M("list"));return e.createElement("ul",n,r)}(),me=y.filter?e.createElement(L,{filter:F,filterIcon:y.filterIcon,onFilter:_,resetFilter:J,filterTemplate:y.filterTemplate,disabled:y.disabled,filterPlaceholder:y.filterPlaceholder,filterInputProps:y.filterInputProps,ptm:M}):null,de=i({className:pe,style:y.listStyle},M("wrapper")),be=i({ref:S,id:y.id,className:se,style:y.style},T.getOtherProps(y),M("root"));return e.createElement(e.Fragment,null,e.createElement("div",be,me,e.createElement("div",de,fe)),ae&&e.createElement(o,v({target:S,content:y.tooltip},y.tooltipOptions,{pt:M("tooltip")})))})));B.displayName="ListBox";export{B as ListBox};
