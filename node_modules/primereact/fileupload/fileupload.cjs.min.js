"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var e=require("react"),t=require("primereact/api"),n=require("primereact/utils"),r=require("primereact/componentbase"),l=require("primereact/button"),o=require("primereact/icons/plus"),a=require("primereact/icons/times"),i=require("primereact/icons/upload"),s=require("primereact/messages"),c=require("primereact/progressbar"),u=require("primereact/ripple");function p(e){if(e&&e.__esModule)return e;var t=Object.create(null);return e&&Object.keys(e).forEach((function(n){if("default"!==n){var r=Object.getOwnPropertyDescriptor(e,n);Object.defineProperty(t,n,r.get?r:{enumerable:!0,get:function(){return e[n]}})}})),t.default=e,Object.freeze(t)}var m=p(e);function f(e){return f="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},f(e)}function d(e,t){if("object"!==f(e)||null===e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var r=n.call(e,t||"default");if("object"!==f(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}function y(e){var t=d(e,"string");return"symbol"===f(t)?t:String(t)}function b(e,t,n){return(t=y(t))in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function v(){return v=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e},v.apply(this,arguments)}function g(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function h(e){if(Array.isArray(e))return g(e)}function E(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}function O(e,t){if(e){if("string"==typeof e)return g(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?g(e,t):void 0}}function S(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function P(e){return h(e)||E(e)||O(e)||S()}function N(e){throw new TypeError('"'+e+'" is read-only')}function w(e){if(Array.isArray(e))return e}function j(e,t){var n=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=n){var r,l,o,a,i=[],s=!0,c=!1;try{if(o=(n=n.call(e)).next,0===t){if(Object(n)!==n)return;s=!1}else for(;!(s=(r=o.call(n)).done)&&(i.push(r.value),i.length!==t);s=!0);}catch(e){c=!0,l=e}finally{try{if(!s&&null!=n.return&&(a=n.return(),Object(a)!==a))return}finally{if(c)throw l}}return i}}function B(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function I(e,t){return w(e)||j(e,t)||O(e,t)||B()}var U=r.ComponentBase.extend({defaultProps:{__TYPE:"Badge",value:null,severity:null,size:null,style:null,className:null,children:void 0}}),C=m.memo(m.forwardRef((function(e,r){var l=m.useContext(t.PrimeReactContext),o=U.getProps(e,l),a=U.setMetaData({props:o}).ptm,i=m.useRef(null),s=n.classNames("p-badge p-component",b({"p-badge-no-gutter":n.ObjectUtils.isNotEmpty(o.value)&&1===String(o.value).length,"p-badge-dot":n.ObjectUtils.isEmpty(o.value),"p-badge-lg":"large"===o.size,"p-badge-xl":"xlarge"===o.size},"p-badge-".concat(o.severity),null!==o.severity),o.className);m.useImperativeHandle(r,(function(){return{props:o,getElement:function(){return i.current}}}));var c=n.mergeProps({ref:i,style:o.style,className:s},U.getOtherProps(o),a("root"));return m.createElement("span",c,o.value)})));C.displayName="Badge";var T=r.ComponentBase.extend({defaultProps:{__TYPE:"FileUpload",id:null,name:null,url:null,mode:"advanced",multiple:!1,accept:null,removeIcon:null,disabled:!1,auto:!1,maxFileSize:null,invalidFileSizeMessageSummary:"{0}: Invalid file size, ",invalidFileSizeMessageDetail:"maximum upload size is {0}.",style:null,className:null,withCredentials:!1,previewWidth:50,chooseLabel:null,uploadLabel:null,cancelLabel:null,chooseOptions:{label:null,icon:null,iconOnly:!1,className:null,style:null},uploadOptions:{label:null,icon:null,iconOnly:!1,className:null,style:null},cancelOptions:{label:null,icon:null,iconOnly:!1,className:null,style:null},customUpload:!1,headerClassName:null,headerStyle:null,contentClassName:null,contentStyle:null,headerTemplate:null,itemTemplate:null,emptyTemplate:null,progressBarTemplate:null,onBeforeUpload:null,onBeforeSend:null,onBeforeDrop:null,onBeforeSelect:null,onUpload:null,onError:null,onClear:null,onSelect:null,onProgress:null,onValidationFail:null,uploadHandler:null,onRemove:null,children:void 0}});function F(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function x(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?F(Object(n),!0).forEach((function(t){b(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):F(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function D(e,t){var n="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=z(e))||t&&e&&"number"==typeof e.length){n&&(e=n);var r=0,l=function(){};return{s:l,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(e){throw e},f:l}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var o,a=!0,i=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return a=e.done,e},e:function(e){i=!0,o=e},f:function(){try{a||null==n.return||n.return()}finally{if(i)throw o}}}}function z(e,t){if(e){if("string"==typeof e)return M(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?M(e,t):void 0}}function M(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}var R=m.memo(m.forwardRef((function(e,r){var p=m.useContext(t.PrimeReactContext),f=T.getProps(e,p),d=I(m.useState([]),2),y=d[0],b=d[1],g=I(m.useState([]),2),h=g[0],E=g[1],O=I(m.useState(0),2),S=O[0],w=O[1],j=I(m.useState(!1),2),B=j[0],U=j[1],F=I(m.useState(!1),2),z=F[0],M=F[1],R=T.setMetaData({props:f,state:{progress:S,uploading:z,uploadedFiles:y,files:h,focused:B}}).ptm,L=m.useRef(null),A=m.useRef(null),k=m.useRef(null),q=m.useRef(!1),_=m.useRef(0),H=n.ObjectUtils.isNotEmpty(h),X=n.ObjectUtils.isNotEmpty(y),J=f.disabled||z,V=f.chooseLabel||f.chooseOptions.label||t.localeOption("choose"),K=f.uploadLabel||f.uploadOptions.label||t.localeOption("upload"),Y=f.cancelLabel||f.cancelOptions.label||t.localeOption("cancel"),W=J||f.fileLimit&&f.fileLimit<=h.length+_,$=J||!H,G=J||!H,Z=function(e){return/^image\//.test(e.type)},Q=function(e,t){te();var n=P(h),r=h[t];n.splice(t,1),E(n),f.onRemove&&f.onRemove({originalEvent:e,file:r})},ee=function(e,t){te();var n=P(y),r=h[t];n.splice(t,1),b(n),f.onRemove&&f.onRemove({originalEvent:e,file:r})},te=function(){L.current&&(L.current.value="")},ne=function(e){if(0===e)return"0 B";var t=Math.floor(Math.log(e)/Math.log(1e3));return parseFloat((e/Math.pow(1e3,t)).toFixed(3))+" "+["B","KB","MB","GB","TB","PB","EB","ZB","YB"][t]},re=function(e){if(!f.onBeforeSelect||!1!==f.onBeforeSelect({originalEvent:e,files:h}))if("drop"!==e.type&&oe()&&q.current)q.current=!1;else{for(var t=h&&f.multiple?P(h):[],r=e.dataTransfer?e.dataTransfer.files:e.target.files,l=0;l<r.length;l++){var o=r[l];f.multiple&&le(o)||!ae(o)||(Z(o)&&(o.objectURL=window.URL.createObjectURL(o)),t.push(o))}E(t),n.ObjectUtils.isNotEmpty(t)&&f.auto&&ie(t),f.onSelect&&f.onSelect({originalEvent:e,files:t}),"drop"!==e.type&&oe()?L.current&&(q.current=!0,L.current.value=""):te(),"basic"===f.mode&&t.length>0&&(L.current.style.display="none")}},le=function(e){return h.some((function(t){return t.name+t.type+t.size===e.name+e.type+e.size}))},oe=function(){return!!window.MSInputMethodContext&&!!document.documentMode},ae=function(e){if(f.maxFileSize&&e.size>f.maxFileSize){var t={severity:"error",summary:f.invalidFileSizeMessageSummary.replace("{0}",e.name),detail:f.invalidFileSizeMessageDetail.replace("{0}",ne(f.maxFileSize)),sticky:!0};return"advanced"===f.mode&&A.current.show(t),f.onValidationFail&&f.onValidationFail(e),!1}return!0},ie=function(e){if((e=e||h)&&e.nativeEvent&&(e=h),f.customUpload)f.fileLimit&&N("uploadedFileCount"),f.uploadHandler&&f.uploadHandler({files:e,options:{clear:se,props:f}});else{M(!0);var t=new XMLHttpRequest,n=new FormData;f.onBeforeUpload&&f.onBeforeUpload({xhr:t,formData:n});var r,l=D(e);try{for(l.s();!(r=l.n()).done;){var o=r.value;n.append(f.name,o,o.name)}}catch(e){l.e(e)}finally{l.f()}t.upload.addEventListener("progress",(function(e){if(e.lengthComputable){var t=Math.round(100*e.loaded/e.total);w(t),f.onProgress&&f.onProgress({originalEvent:e,progress:t})}})),t.onreadystatechange=function(){4===t.readyState&&(w(0),M(!1),t.status>=200&&t.status<300?(f.fileLimit&&N("uploadedFileCount"),f.onUpload&&f.onUpload({xhr:t,files:e})):f.onError&&f.onError({xhr:t,files:e}),b((function(t){return[].concat(P(t),P(e))})),se())},t.open("POST",f.url,!0),f.onBeforeSend&&f.onBeforeSend({xhr:t,formData:n}),t.withCredentials=f.withCredentials,t.send(n)}},se=function(){E([]),b([]),M(!1),f.onClear&&f.onClear(),te()},ce=function(){L.current.click()},ue=function(){U(!0)},pe=function(){U(!1)},me=function(e){13===e.which&&ce()},fe=function(e){if(!f.disabled&&(n.DomHandler.removeClass(k.current,"p-fileupload-highlight"),e.stopPropagation(),e.preventDefault(),!f.onBeforeDrop||!1!==f.onBeforeDrop(e))){var t=e.dataTransfer?e.dataTransfer.files:e.target.files;(f.multiple||n.ObjectUtils.isEmpty(h)&&t&&1===t.length)&&re(e)}},de=function(){!J&&H?ie():L.current.click()};m.useImperativeHandle(r,(function(){return{props:f,upload:ie,clear:se,formatSize:ne,onFileSelect:re,getInput:function(){return L.current},getContent:function(){return k.current},getFiles:function(){return h},setFiles:function(e){return E(e||[])},getUploadedFiles:function(){return y},setUploadedFiles:function(e){return b(e||[])}}}));var ye,be,ve,ge,he,Ee,Oe,Se,Pe,Ne,we,je,Be,Ie=function(e,t,n){"warning"===t.severity?Q(e,n):ee(e,n)},Ue=function(e,t,r){var o=e.name+e.type+e.size,i=n.mergeProps({role:"presentation",className:"p-fileupload-file-thumbnail",src:e.objectURL,width:f.previewWidth},R("thumbnail")),s=Z(e)?m.createElement("img",v({},i,{alt:e.name})):null,c=n.mergeProps(R("details")),u=n.mergeProps(R("fileSize")),p=n.mergeProps({className:"p-fileupload-filename"},R("fileName")),d=n.mergeProps(R("actions")),y=m.createElement("div",p,e.name),b=m.createElement("div",u,ne(e.size)),g=m.createElement("div",c,m.createElement("div",p," ",e.name),m.createElement("span",u,ne(e.size)),m.createElement(C,{className:"p-fileupload-file-badge",value:r.value,severity:r.severity,pt:R("badge")})),h=m.createElement("div",d,m.createElement(l.Button,{type:"button",icon:f.removeIcon||m.createElement(a.TimesIcon,null),text:!0,rounded:!0,severity:"danger",onClick:function(e){return Ie(e,r,t)},disabled:J,pt:R("removeButton")})),E=m.createElement(m.Fragment,null,s,g,h);if(f.itemTemplate){var O={onRemove:function(e){return Q(e,t)},previewElement:s,fileNameElement:y,sizeElement:b,removeElement:h,formatSize:ne(e.size),element:E,index:t,props:f};E=n.ObjectUtils.getJSXElement(f.itemTemplate,e,O)}var S=n.mergeProps({key:o,className:"p-fileupload-row"},R("file"));return m.createElement("div",S,E)},Ce=function(){var e={severity:"success",value:"Completed"},t=y&&y.map((function(t,n){return Ue(t,n,e)}));return m.createElement("div",null,t)};return"advanced"===f.mode?function(){var e,t,r,p,d,y,b,g,E,O,P,N,w,j,I,U,C,F,D,z,M=n.classNames("p-fileupload p-fileupload-advanced p-component",f.className),q=n.classNames("p-fileupload-buttonbar",f.headerClassName),_=n.classNames("p-fileupload-content",f.contentClassName),Z=(t=(e=f.chooseOptions).style,r=e.icon,d=n.classNames("p-button p-fileupload-choose p-component",{"p-disabled":J,"p-focus":B,"p-button-icon-only":p=e.iconOnly},e.className),y=n.classNames("p-button-icon p-clickable",{"p-button-icon-left":!p}),b=n.mergeProps({className:"p-button-label p-clickable"},R("chooseButtonLabel")),g=p?m.createElement("span",v({},b,{dangerouslySetInnerHTML:{__html:"&nbsp;"}})):m.createElement("span",b,V),E=n.mergeProps({ref:L,type:"file",onChange:function(e){return re(e)},multiple:f.multiple,accept:f.accept,disabled:W},R("input")),O=m.createElement("input",E),P=n.mergeProps({className:y},R("chooseIcon")),N=n.IconUtils.getJSXIcon(r||m.createElement(o.PlusIcon,P),x({},P),{props:f}),w=n.mergeProps({className:d,style:t,onClick:ce,onKeyDown:function(e){return me(e)},onFocus:ue,onBlur:pe,tabIndex:0},R("chooseButton")),m.createElement("span",w,O,N,g,m.createElement(u.Ripple,null))),Q=!f.emptyTemplate||H||X?null:n.ObjectUtils.getJSXElement(f.emptyTemplate,f);if(!f.auto){var ee=f.uploadOptions,te=f.cancelOptions,ne=ee.iconOnly?"":K,le=te.iconOnly?"":Y,oe=n.classNames("p-button-icon p-c",{"p-button-icon-left":!ee.iconOnly}),ae=n.mergeProps({className:oe},R("uploadIcon")),de=n.IconUtils.getJSXIcon(ee.icon||m.createElement(i.UploadIcon,ae),x({},ae),{props:f}),ye=n.classNames("p-button-icon p-c",{"p-button-icon-left":!te.iconOnly}),be=n.mergeProps({className:ye},R("cancelIcon")),ve=n.IconUtils.getJSXIcon(te.icon||m.createElement(a.TimesIcon,be),x({},be),{props:f});j=m.createElement(l.Button,{type:"button",label:ne,icon:de,onClick:ie,disabled:$,style:ee.style,className:ee.className,pt:R("uploadButton")}),I=m.createElement(l.Button,{type:"button",label:le,icon:ve,onClick:se,disabled:G,style:te.style,className:te.className,pt:R("cancelButton")})}H&&(D={severity:"warning",value:"Pending"},z=h.map((function(e,t){return Ue(e,t,D)})),U=m.createElement("div",null,z),F=f.progressBarTemplate?n.ObjectUtils.getJSXElement(f.progressBarTemplate,f):m.createElement(c.ProgressBar,{value:S,showValue:!1,pt:R("progressbar")})),X&&(C=Ce());var ge=n.mergeProps({className:q,style:f.headerStyle},R("buttonbar")),he=m.createElement("div",ge,Z,j,I);f.headerTemplate&&(he=n.ObjectUtils.getJSXElement(f.headerTemplate,{className:q,chooseButton:Z,uploadButton:j,cancelButton:I,element:he,props:f}));var Ee=n.mergeProps({id:f.id,className:M,style:f.style},T.getOtherProps(f),R("root")),Oe=n.mergeProps({ref:k,className:_,style:f.contentStyle,onDragEnter:function(e){return t=e,void(J||(t.dataTransfer.dropEffect="copy",t.stopPropagation(),t.preventDefault()));var t},onDragOver:function(e){return t=e,void(J||(t.dataTransfer.dropEffect="copy",n.DomHandler.addClass(k.current,"p-fileupload-highlight"),t.stopPropagation(),t.preventDefault()));var t},onDragLeave:function(e){return t=e,void(J||(t.dataTransfer.dropEffect="copy",n.DomHandler.removeClass(k.current,"p-fileupload-highlight")));var t},onDrop:function(e){return fe(e)}},R("content"));return m.createElement("div",Ee,he,m.createElement("div",Oe,F,m.createElement(s.Messages,{ref:A}),H?U:null,X?C:null,Q))}():"basic"===f.mode?(ye=f.chooseOptions,be=n.classNames("p-fileupload p-fileupload-basic p-component",f.className),ve=n.classNames("p-button p-component p-fileupload-choose",{"p-fileupload-choose-selected":H,"p-disabled":J,"p-focus":B},ye.className),ge=n.mergeProps({className:"p-button-label p-clickable"},R("label")),he=ye.iconOnly?m.createElement("span",v({},ge,{dangerouslySetInnerHTML:{__html:"&nbsp;"}})):m.createElement("span",ge,V),Ee=f.auto?he:m.createElement("span",ge,H?h[0].name:he),Oe=n.classNames("p-button-icon",{"p-button-icon-left":!ye.iconOnly}),Se=n.mergeProps({className:Oe},R("chooseIcon")),Pe=n.IconUtils.getJSXIcon(ye.icon?ye.icon:ye.icon||H&&!f.auto?!ye.icon&&H&&!f.auto&&m.createElement(i.UploadIcon,Se):m.createElement(o.PlusIcon,Se),x({},Se),{props:f,hasFiles:H}),Ne=n.mergeProps({ref:L,type:"file",onChange:function(e){return re(e)},multiple:f.multiple,accept:f.accept,disabled:J},R("input")),we=!H&&m.createElement("input",Ne),je=n.mergeProps({className:be,style:f.style},T.getOtherProps(f),R("root")),Be=n.mergeProps({className:ve,style:ye.style,tabIndex:0,onMouseUp:de,onKeyDown:function(e){return me(e)},onFocus:ue,onBlur:pe},T.getOtherProps(f),R("basicButton")),m.createElement("div",je,m.createElement(s.Messages,{ref:A,pt:R("message")}),m.createElement("span",Be,Pe,Ee,we,m.createElement(u.Ripple,null)))):void 0})));R.displayName="FileUpload",exports.FileUpload=R;
