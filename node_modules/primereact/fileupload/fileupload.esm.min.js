import*as e from"react";import{PrimeReactContext as t,localeOption as n}from"primereact/api";import{classNames as r,ObjectUtils as l,mergeProps as o,IconUtils as a,DomHandler as i}from"primereact/utils";import{ComponentBase as u}from"primereact/componentbase";import{Button as c}from"primereact/button";import{PlusIcon as s}from"primereact/icons/plus";import{TimesIcon as p}from"primereact/icons/times";import{UploadIcon as m}from"primereact/icons/upload";import{Messages as f}from"primereact/messages";import{ProgressBar as d}from"primereact/progressbar";import{Ripple as y}from"primereact/ripple";function v(e){return v="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},v(e)}function b(e,t){if("object"!==v(e)||null===e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var r=n.call(e,t||"default");if("object"!==v(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}function g(e){var t=b(e,"string");return"symbol"===v(t)?t:String(t)}function h(e,t,n){return(t=g(t))in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function E(){return E=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e},E.apply(this,arguments)}function S(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function O(e){if(Array.isArray(e))return S(e)}function w(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}function N(e,t){if(e){if("string"==typeof e)return S(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?S(e,t):void 0}}function B(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function P(e){return O(e)||w(e)||N(e)||B()}function T(e){throw new TypeError('"'+e+'" is read-only')}function j(e){if(Array.isArray(e))return e}function C(e,t){var n=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=n){var r,l,o,a,i=[],u=!0,c=!1;try{if(o=(n=n.call(e)).next,0===t){if(Object(n)!==n)return;u=!1}else for(;!(u=(r=o.call(n)).done)&&(i.push(r.value),i.length!==t);u=!0);}catch(e){c=!0,l=e}finally{try{if(!u&&null!=n.return&&(a=n.return(),Object(a)!==a))return}finally{if(c)throw l}}return i}}function F(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function I(e,t){return j(e)||C(e,t)||N(e,t)||F()}var x=u.extend({defaultProps:{__TYPE:"Badge",value:null,severity:null,size:null,style:null,className:null,children:void 0}}),z=e.memo(e.forwardRef((function(n,a){var i=e.useContext(t),u=x.getProps(n,i),c=x.setMetaData({props:u}).ptm,s=e.useRef(null),p=r("p-badge p-component",h({"p-badge-no-gutter":l.isNotEmpty(u.value)&&1===String(u.value).length,"p-badge-dot":l.isEmpty(u.value),"p-badge-lg":"large"===u.size,"p-badge-xl":"xlarge"===u.size},"p-badge-".concat(u.severity),null!==u.severity),u.className);e.useImperativeHandle(a,(function(){return{props:u,getElement:function(){return s.current}}}));var m=o({ref:s,style:u.style,className:p},x.getOtherProps(u),c("root"));return e.createElement("span",m,u.value)})));z.displayName="Badge";var D=u.extend({defaultProps:{__TYPE:"FileUpload",id:null,name:null,url:null,mode:"advanced",multiple:!1,accept:null,removeIcon:null,disabled:!1,auto:!1,maxFileSize:null,invalidFileSizeMessageSummary:"{0}: Invalid file size, ",invalidFileSizeMessageDetail:"maximum upload size is {0}.",style:null,className:null,withCredentials:!1,previewWidth:50,chooseLabel:null,uploadLabel:null,cancelLabel:null,chooseOptions:{label:null,icon:null,iconOnly:!1,className:null,style:null},uploadOptions:{label:null,icon:null,iconOnly:!1,className:null,style:null},cancelOptions:{label:null,icon:null,iconOnly:!1,className:null,style:null},customUpload:!1,headerClassName:null,headerStyle:null,contentClassName:null,contentStyle:null,headerTemplate:null,itemTemplate:null,emptyTemplate:null,progressBarTemplate:null,onBeforeUpload:null,onBeforeSend:null,onBeforeDrop:null,onBeforeSelect:null,onUpload:null,onError:null,onClear:null,onSelect:null,onProgress:null,onValidationFail:null,uploadHandler:null,onRemove:null,children:void 0}});function M(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function L(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?M(Object(n),!0).forEach((function(t){h(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):M(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function R(e,t){var n="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=U(e))||t&&e&&"number"==typeof e.length){n&&(e=n);var r=0,l=function(){};return{s:l,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(e){throw e},f:l}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var o,a=!0,i=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return a=e.done,e},e:function(e){i=!0,o=e},f:function(){try{a||null==n.return||n.return()}finally{if(i)throw o}}}}function U(e,t){if(e){if("string"==typeof e)return A(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?A(e,t):void 0}}function A(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}var k=e.memo(e.forwardRef((function(u,v){var b=e.useContext(t),g=D.getProps(u,b),h=I(e.useState([]),2),S=h[0],O=h[1],w=I(e.useState([]),2),N=w[0],B=w[1],j=I(e.useState(0),2),C=j[0],F=j[1],x=I(e.useState(!1),2),M=x[0],U=x[1],A=I(e.useState(!1),2),k=A[0],X=A[1],H=D.setMetaData({props:g,state:{progress:C,uploading:k,uploadedFiles:S,files:N,focused:M}}).ptm,J=e.useRef(null),_=e.useRef(null),V=e.useRef(null),K=e.useRef(!1),Y=e.useRef(0),W=l.isNotEmpty(N),$=l.isNotEmpty(S),q=g.disabled||k,G=g.chooseLabel||g.chooseOptions.label||n("choose"),Z=g.uploadLabel||g.uploadOptions.label||n("upload"),Q=g.cancelLabel||g.cancelOptions.label||n("cancel"),ee=q||g.fileLimit&&g.fileLimit<=N.length+Y,te=q||!W,ne=q||!W,re=function(e){return/^image\//.test(e.type)},le=function(e,t){ae();var n=P(N),r=N[t];n.splice(t,1),B(n),g.onRemove&&g.onRemove({originalEvent:e,file:r})},oe=function(e,t){ae();var n=P(S),r=N[t];n.splice(t,1),O(n),g.onRemove&&g.onRemove({originalEvent:e,file:r})},ae=function(){J.current&&(J.current.value="")},ie=function(e){if(0===e)return"0 B";var t=Math.floor(Math.log(e)/Math.log(1e3));return parseFloat((e/Math.pow(1e3,t)).toFixed(3))+" "+["B","KB","MB","GB","TB","PB","EB","ZB","YB"][t]},ue=function(e){if(!g.onBeforeSelect||!1!==g.onBeforeSelect({originalEvent:e,files:N}))if("drop"!==e.type&&se()&&K.current)K.current=!1;else{for(var t=N&&g.multiple?P(N):[],n=e.dataTransfer?e.dataTransfer.files:e.target.files,r=0;r<n.length;r++){var o=n[r];g.multiple&&ce(o)||!pe(o)||(re(o)&&(o.objectURL=window.URL.createObjectURL(o)),t.push(o))}B(t),l.isNotEmpty(t)&&g.auto&&me(t),g.onSelect&&g.onSelect({originalEvent:e,files:t}),"drop"!==e.type&&se()?J.current&&(K.current=!0,J.current.value=""):ae(),"basic"===g.mode&&t.length>0&&(J.current.style.display="none")}},ce=function(e){return N.some((function(t){return t.name+t.type+t.size===e.name+e.type+e.size}))},se=function(){return!!window.MSInputMethodContext&&!!document.documentMode},pe=function(e){if(g.maxFileSize&&e.size>g.maxFileSize){var t={severity:"error",summary:g.invalidFileSizeMessageSummary.replace("{0}",e.name),detail:g.invalidFileSizeMessageDetail.replace("{0}",ie(g.maxFileSize)),sticky:!0};return"advanced"===g.mode&&_.current.show(t),g.onValidationFail&&g.onValidationFail(e),!1}return!0},me=function(e){if((e=e||N)&&e.nativeEvent&&(e=N),g.customUpload)g.fileLimit&&T("uploadedFileCount"),g.uploadHandler&&g.uploadHandler({files:e,options:{clear:fe,props:g}});else{X(!0);var t=new XMLHttpRequest,n=new FormData;g.onBeforeUpload&&g.onBeforeUpload({xhr:t,formData:n});var r,l=R(e);try{for(l.s();!(r=l.n()).done;){var o=r.value;n.append(g.name,o,o.name)}}catch(e){l.e(e)}finally{l.f()}t.upload.addEventListener("progress",(function(e){if(e.lengthComputable){var t=Math.round(100*e.loaded/e.total);F(t),g.onProgress&&g.onProgress({originalEvent:e,progress:t})}})),t.onreadystatechange=function(){4===t.readyState&&(F(0),X(!1),t.status>=200&&t.status<300?(g.fileLimit&&T("uploadedFileCount"),g.onUpload&&g.onUpload({xhr:t,files:e})):g.onError&&g.onError({xhr:t,files:e}),O((function(t){return[].concat(P(t),P(e))})),fe())},t.open("POST",g.url,!0),g.onBeforeSend&&g.onBeforeSend({xhr:t,formData:n}),t.withCredentials=g.withCredentials,t.send(n)}},fe=function(){B([]),O([]),X(!1),g.onClear&&g.onClear(),ae()},de=function(){J.current.click()},ye=function(){U(!0)},ve=function(){U(!1)},be=function(e){13===e.which&&de()},ge=function(e){if(!g.disabled&&(i.removeClass(V.current,"p-fileupload-highlight"),e.stopPropagation(),e.preventDefault(),!g.onBeforeDrop||!1!==g.onBeforeDrop(e))){var t=e.dataTransfer?e.dataTransfer.files:e.target.files;(g.multiple||l.isEmpty(N)&&t&&1===t.length)&&ue(e)}},he=function(){!q&&W?me():J.current.click()};e.useImperativeHandle(v,(function(){return{props:g,upload:me,clear:fe,formatSize:ie,onFileSelect:ue,getInput:function(){return J.current},getContent:function(){return V.current},getFiles:function(){return N},setFiles:function(e){return B(e||[])},getUploadedFiles:function(){return S},setUploadedFiles:function(e){return O(e||[])}}}));var Ee,Se,Oe,we,Ne,Be,Pe,Te,je,Ce,Fe,Ie,xe,ze=function(e,t,n){"warning"===t.severity?le(e,n):oe(e,n)},De=function(t,n,r){var a=t.name+t.type+t.size,i=o({role:"presentation",className:"p-fileupload-file-thumbnail",src:t.objectURL,width:g.previewWidth},H("thumbnail")),u=re(t)?e.createElement("img",E({},i,{alt:t.name})):null,s=o(H("details")),m=o(H("fileSize")),f=o({className:"p-fileupload-filename"},H("fileName")),d=o(H("actions")),y=e.createElement("div",f,t.name),v=e.createElement("div",m,ie(t.size)),b=e.createElement("div",s,e.createElement("div",f," ",t.name),e.createElement("span",m,ie(t.size)),e.createElement(z,{className:"p-fileupload-file-badge",value:r.value,severity:r.severity,pt:H("badge")})),h=e.createElement("div",d,e.createElement(c,{type:"button",icon:g.removeIcon||e.createElement(p,null),text:!0,rounded:!0,severity:"danger",onClick:function(e){return ze(e,r,n)},disabled:q,pt:H("removeButton")})),S=e.createElement(e.Fragment,null,u,b,h);if(g.itemTemplate){var O={onRemove:function(e){return le(e,n)},previewElement:u,fileNameElement:y,sizeElement:v,removeElement:h,formatSize:ie(t.size),element:S,index:n,props:g};S=l.getJSXElement(g.itemTemplate,t,O)}var w=o({key:a,className:"p-fileupload-row"},H("file"));return e.createElement("div",w,S)},Me=function(){var t={severity:"success",value:"Completed"},n=S&&S.map((function(e,n){return De(e,n,t)}));return e.createElement("div",null,n)};return"advanced"===g.mode?function(){var t,n,u,v,b,h,S,O,w,B,P,T,j,F,I,x,z,R,U,A,k=r("p-fileupload p-fileupload-advanced p-component",g.className),X=r("p-fileupload-buttonbar",g.headerClassName),K=r("p-fileupload-content",g.contentClassName),Y=(n=(t=g.chooseOptions).style,u=t.icon,b=r("p-button p-fileupload-choose p-component",{"p-disabled":q,"p-focus":M,"p-button-icon-only":v=t.iconOnly},t.className),h=r("p-button-icon p-clickable",{"p-button-icon-left":!v}),S=o({className:"p-button-label p-clickable"},H("chooseButtonLabel")),O=v?e.createElement("span",E({},S,{dangerouslySetInnerHTML:{__html:"&nbsp;"}})):e.createElement("span",S,G),w=o({ref:J,type:"file",onChange:function(e){return ue(e)},multiple:g.multiple,accept:g.accept,disabled:ee},H("input")),B=e.createElement("input",w),P=o({className:h},H("chooseIcon")),T=a.getJSXIcon(u||e.createElement(s,P),L({},P),{props:g}),j=o({className:b,style:n,onClick:de,onKeyDown:function(e){return be(e)},onFocus:ye,onBlur:ve,tabIndex:0},H("chooseButton")),e.createElement("span",j,B,T,O,e.createElement(y,null))),re=!g.emptyTemplate||W||$?null:l.getJSXElement(g.emptyTemplate,g);if(!g.auto){var le=g.uploadOptions,oe=g.cancelOptions,ae=le.iconOnly?"":Z,ie=oe.iconOnly?"":Q,ce=r("p-button-icon p-c",{"p-button-icon-left":!le.iconOnly}),se=o({className:ce},H("uploadIcon")),pe=a.getJSXIcon(le.icon||e.createElement(m,se),L({},se),{props:g}),he=r("p-button-icon p-c",{"p-button-icon-left":!oe.iconOnly}),Ee=o({className:he},H("cancelIcon")),Se=a.getJSXIcon(oe.icon||e.createElement(p,Ee),L({},Ee),{props:g});F=e.createElement(c,{type:"button",label:ae,icon:pe,onClick:me,disabled:te,style:le.style,className:le.className,pt:H("uploadButton")}),I=e.createElement(c,{type:"button",label:ie,icon:Se,onClick:fe,disabled:ne,style:oe.style,className:oe.className,pt:H("cancelButton")})}W&&(U={severity:"warning",value:"Pending"},A=N.map((function(e,t){return De(e,t,U)})),x=e.createElement("div",null,A),R=g.progressBarTemplate?l.getJSXElement(g.progressBarTemplate,g):e.createElement(d,{value:C,showValue:!1,pt:H("progressbar")})),$&&(z=Me());var Oe=o({className:X,style:g.headerStyle},H("buttonbar")),we=e.createElement("div",Oe,Y,F,I);g.headerTemplate&&(we=l.getJSXElement(g.headerTemplate,{className:X,chooseButton:Y,uploadButton:F,cancelButton:I,element:we,props:g}));var Ne=o({id:g.id,className:k,style:g.style},D.getOtherProps(g),H("root")),Be=o({ref:V,className:K,style:g.contentStyle,onDragEnter:function(e){return t=e,void(q||(t.dataTransfer.dropEffect="copy",t.stopPropagation(),t.preventDefault()));var t},onDragOver:function(e){return t=e,void(q||(t.dataTransfer.dropEffect="copy",i.addClass(V.current,"p-fileupload-highlight"),t.stopPropagation(),t.preventDefault()));var t},onDragLeave:function(e){return t=e,void(q||(t.dataTransfer.dropEffect="copy",i.removeClass(V.current,"p-fileupload-highlight")));var t},onDrop:function(e){return ge(e)}},H("content"));return e.createElement("div",Ne,we,e.createElement("div",Be,R,e.createElement(f,{ref:_}),W?x:null,$?z:null,re))}():"basic"===g.mode?(Ee=g.chooseOptions,Se=r("p-fileupload p-fileupload-basic p-component",g.className),Oe=r("p-button p-component p-fileupload-choose",{"p-fileupload-choose-selected":W,"p-disabled":q,"p-focus":M},Ee.className),we=o({className:"p-button-label p-clickable"},H("label")),Ne=Ee.iconOnly?e.createElement("span",E({},we,{dangerouslySetInnerHTML:{__html:"&nbsp;"}})):e.createElement("span",we,G),Be=g.auto?Ne:e.createElement("span",we,W?N[0].name:Ne),Pe=r("p-button-icon",{"p-button-icon-left":!Ee.iconOnly}),Te=o({className:Pe},H("chooseIcon")),je=a.getJSXIcon(Ee.icon?Ee.icon:Ee.icon||W&&!g.auto?!Ee.icon&&W&&!g.auto&&e.createElement(m,Te):e.createElement(s,Te),L({},Te),{props:g,hasFiles:W}),Ce=o({ref:J,type:"file",onChange:function(e){return ue(e)},multiple:g.multiple,accept:g.accept,disabled:q},H("input")),Fe=!W&&e.createElement("input",Ce),Ie=o({className:Se,style:g.style},D.getOtherProps(g),H("root")),xe=o({className:Oe,style:Ee.style,tabIndex:0,onMouseUp:he,onKeyDown:function(e){return be(e)},onFocus:ye,onBlur:ve},D.getOtherProps(g),H("basicButton")),e.createElement("div",Ie,e.createElement(f,{ref:_,pt:H("message")}),e.createElement("span",xe,je,Be,Fe,e.createElement(y,null)))):void 0})));k.displayName="FileUpload";export{k as FileUpload};
